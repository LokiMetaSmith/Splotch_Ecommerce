var kr=Object.defineProperty;var Pn=e=>{throw TypeError(e)};var Kr=(e,t,n)=>t in e?kr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var T=(e,t,n)=>Kr(e,typeof t!="symbol"?t+"":t,n),Ln=(e,t,n)=>t.has(e)||Pn("Cannot "+n);var A=(e,t,n)=>(Ln(e,t,"read from private field"),n?n.call(e):t.get(e)),B=(e,t,n)=>t.has(e)?Pn("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),D=(e,t,n,r)=>(Ln(e,t,"write to private field"),r?r.call(e,n):t.set(e,n),n);import"./modulepreload-polyfill-B5Qt9EMX.js";/* empty css               */function ne(e){const t=new Uint8Array(e);let n="";for(const a of t)n+=String.fromCharCode(a);return btoa(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function wt(e){const t=e.replace(/-/g,"+").replace(/_/g,"/"),n=(4-t.length%4)%4,r=t.padEnd(t.length+n,"="),a=atob(r),i=new ArrayBuffer(a.length),o=new Uint8Array(i);for(let c=0;c<a.length;c++)o[c]=a.charCodeAt(c);return i}function Qt(){return Ur.stubThis((globalThis==null?void 0:globalThis.PublicKeyCredential)!==void 0&&typeof globalThis.PublicKeyCredential=="function")}const Ur={stubThis:e=>e};function nr(e){const{id:t}=e;return{...e,id:wt(t),transports:e.transports}}function rr(e){return e==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(e)}class M extends Error{constructor({message:t,code:n,cause:r,name:a}){super(t,{cause:r}),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=a??r.name,this.code=n}}function Wr({error:e,options:t}){var r,a,i;const{publicKey:n}=t;if(!n)throw Error("options was missing required publicKey property");if(e.name==="AbortError"){if(t.signal instanceof AbortSignal)return new M({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else if(e.name==="ConstraintError"){if(((r=n.authenticatorSelection)==null?void 0:r.requireResidentKey)===!0)return new M({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:e});if(t.mediation==="conditional"&&((a=n.authenticatorSelection)==null?void 0:a.userVerification)==="required")return new M({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:e});if(((i=n.authenticatorSelection)==null?void 0:i.userVerification)==="required")return new M({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:e})}else{if(e.name==="InvalidStateError")return new M({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:e});if(e.name==="NotAllowedError")return new M({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if(e.name==="NotSupportedError")return n.pubKeyCredParams.filter(c=>c.type==="public-key").length===0?new M({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:e}):new M({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:e});if(e.name==="SecurityError"){const o=globalThis.location.hostname;if(rr(o)){if(n.rp.id!==o)return new M({message:`The RP ID "${n.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else return new M({message:`${globalThis.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e})}else if(e.name==="TypeError"){if(n.user.id.byteLength<1||n.user.id.byteLength>64)return new M({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:e})}else if(e.name==="UnknownError")return new M({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return e}class Hr{constructor(){Object.defineProperty(this,"controller",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}createNewAbortSignal(){if(this.controller){const n=new Error("Cancelling existing WebAuthn API call for new one");n.name="AbortError",this.controller.abort(n)}const t=new AbortController;return this.controller=t,t.signal}cancelCeremony(){if(this.controller){const t=new Error("Manually cancelling existing WebAuthn API call");t.name="AbortError",this.controller.abort(t),this.controller=void 0}}}const ar=new Hr,Fr=["cross-platform","platform"];function sr(e){if(e&&!(Fr.indexOf(e)<0))return e}async function $r(e){var E;!e.optionsJSON&&e.challenge&&(console.warn("startRegistration() was not called correctly. It will try to continue with the provided options, but this call should be refactored to use the expected call structure instead. See https://simplewebauthn.dev/docs/packages/browser#typeerror-cannot-read-properties-of-undefined-reading-challenge for more information."),e={optionsJSON:e});const{optionsJSON:t,useAutoRegister:n=!1}=e;if(!Qt())throw new Error("WebAuthn is not supported in this browser");const r={...t,challenge:wt(t.challenge),user:{...t.user,id:wt(t.user.id)},excludeCredentials:(E=t.excludeCredentials)==null?void 0:E.map(nr)},a={};n&&(a.mediation="conditional"),a.publicKey=r,a.signal=ar.createNewAbortSignal();let i;try{i=await navigator.credentials.create(a)}catch(w){throw Wr({error:w,options:a})}if(!i)throw new Error("Registration was not completed");const{id:o,rawId:c,response:l,type:f}=i;let d;typeof l.getTransports=="function"&&(d=l.getTransports());let g;if(typeof l.getPublicKeyAlgorithm=="function")try{g=l.getPublicKeyAlgorithm()}catch(w){kt("getPublicKeyAlgorithm()",w)}let S;if(typeof l.getPublicKey=="function")try{const w=l.getPublicKey();w!==null&&(S=ne(w))}catch(w){kt("getPublicKey()",w)}let p;if(typeof l.getAuthenticatorData=="function")try{p=ne(l.getAuthenticatorData())}catch(w){kt("getAuthenticatorData()",w)}return{id:o,rawId:ne(c),response:{attestationObject:ne(l.attestationObject),clientDataJSON:ne(l.clientDataJSON),transports:d,publicKeyAlgorithm:g,publicKey:S,authenticatorData:p},type:f,clientExtensionResults:i.getClientExtensionResults(),authenticatorAttachment:sr(i.authenticatorAttachment)}}function kt(e,t){console.warn(`The browser extension that intercepted this WebAuthn API call incorrectly implemented ${e}. You should report this error to them.
`,t)}function Jr(){if(!Qt())return Kt.stubThis(new Promise(t=>t(!1)));const e=globalThis.PublicKeyCredential;return(e==null?void 0:e.isConditionalMediationAvailable)===void 0?Kt.stubThis(new Promise(t=>t(!1))):Kt.stubThis(e.isConditionalMediationAvailable())}const Kt={stubThis:e=>e};function Gr({error:e,options:t}){const{publicKey:n}=t;if(!n)throw Error("options was missing required publicKey property");if(e.name==="AbortError"){if(t.signal instanceof AbortSignal)return new M({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else{if(e.name==="NotAllowedError")return new M({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if(e.name==="SecurityError"){const r=globalThis.location.hostname;if(rr(r)){if(n.rpId!==r)return new M({message:`The RP ID "${n.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else return new M({message:`${globalThis.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e})}else if(e.name==="UnknownError")return new M({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return e}async function zr(e){var p,E;!e.optionsJSON&&e.challenge&&(console.warn("startAuthentication() was not called correctly. It will try to continue with the provided options, but this call should be refactored to use the expected call structure instead. See https://simplewebauthn.dev/docs/packages/browser#typeerror-cannot-read-properties-of-undefined-reading-challenge for more information."),e={optionsJSON:e});const{optionsJSON:t,useBrowserAutofill:n=!1,verifyBrowserAutofillInput:r=!0}=e;if(!Qt())throw new Error("WebAuthn is not supported in this browser");let a;((p=t.allowCredentials)==null?void 0:p.length)!==0&&(a=(E=t.allowCredentials)==null?void 0:E.map(nr));const i={...t,challenge:wt(t.challenge),allowCredentials:a},o={};if(n){if(!await Jr())throw Error("Browser does not support WebAuthn autofill");if(document.querySelectorAll("input[autocomplete$='webauthn']").length<1&&r)throw Error('No <input> with "webauthn" as the only or last value in its `autocomplete` attribute was detected');o.mediation="conditional",i.allowCredentials=[]}o.publicKey=i,o.signal=ar.createNewAbortSignal();let c;try{c=await navigator.credentials.get(o)}catch(w){throw Gr({error:w,options:o})}if(!c)throw new Error("Authentication was not completed");const{id:l,rawId:f,response:d,type:g}=c;let S;return d.userHandle&&(S=ne(d.userHandle)),{id:l,rawId:ne(f),response:{authenticatorData:ne(d.authenticatorData),clientDataJSON:ne(d.clientDataJSON),signature:ne(d.signature),userHandle:S},type:g,clientExtensionResults:c.getClientExtensionResults(),authenticatorAttachment:sr(c.authenticatorAttachment)}}/*! @license DOMPurify 3.2.6 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.2.6/LICENSE */const{entries:ir,setPrototypeOf:Nn,isFrozen:Br,getPrototypeOf:qr,getOwnPropertyDescriptor:Vr}=Object;let{freeze:H,seal:V,create:or}=Object,{apply:Bt,construct:qt}=typeof Reflect<"u"&&Reflect;H||(H=function(t){return t});V||(V=function(t){return t});Bt||(Bt=function(t,n,r){return t.apply(n,r)});qt||(qt=function(t,n){return new t(...n)});const pt=F(Array.prototype.forEach),Yr=F(Array.prototype.lastIndexOf),Dn=F(Array.prototype.pop),Be=F(Array.prototype.push),Xr=F(Array.prototype.splice),bt=F(String.prototype.toLowerCase),Ut=F(String.prototype.toString),Mn=F(String.prototype.match),qe=F(String.prototype.replace),Zr=F(String.prototype.indexOf),Qr=F(String.prototype.trim),X=F(Object.prototype.hasOwnProperty),W=F(RegExp.prototype.test),Ve=jr(TypeError);function F(e){return function(t){t instanceof RegExp&&(t.lastIndex=0);for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return Bt(e,t,r)}}function jr(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return qt(e,n)}}function b(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:bt;Nn&&Nn(e,null);let r=t.length;for(;r--;){let a=t[r];if(typeof a=="string"){const i=n(a);i!==a&&(Br(t)||(t[r]=i),a=i)}e[a]=!0}return e}function ea(e){for(let t=0;t<e.length;t++)X(e,t)||(e[t]=null);return e}function ue(e){const t=or(null);for(const[n,r]of ir(e))X(e,n)&&(Array.isArray(r)?t[n]=ea(r):r&&typeof r=="object"&&r.constructor===Object?t[n]=ue(r):t[n]=r);return t}function Ye(e,t){for(;e!==null;){const r=Vr(e,t);if(r){if(r.get)return F(r.get);if(typeof r.value=="function")return F(r.value)}e=qr(e)}function n(){return null}return n}const kn=H(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),Wt=H(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),Ht=H(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),ta=H(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),Ft=H(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),na=H(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),Kn=H(["#text"]),Un=H(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),$t=H(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),Wn=H(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),yt=H(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),ra=V(/\{\{[\w\W]*|[\w\W]*\}\}/gm),aa=V(/<%[\w\W]*|[\w\W]*%>/gm),sa=V(/\$\{[\w\W]*/gm),ia=V(/^data-[\-\w.\u00B7-\uFFFF]+$/),oa=V(/^aria-[\-\w]+$/),cr=V(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),ca=V(/^(?:\w+script|data):/i),la=V(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),lr=V(/^html$/i),ua=V(/^[a-z][.\w]*(-[.\w]+)+$/i);var Hn=Object.freeze({__proto__:null,ARIA_ATTR:oa,ATTR_WHITESPACE:la,CUSTOM_ELEMENT:ua,DATA_ATTR:ia,DOCTYPE_NAME:lr,ERB_EXPR:aa,IS_ALLOWED_URI:cr,IS_SCRIPT_OR_DATA:ca,MUSTACHE_EXPR:ra,TMPLIT_EXPR:sa});const Xe={element:1,text:3,progressingInstruction:7,comment:8,document:9},fa=function(){return typeof window>"u"?null:window},da=function(t,n){if(typeof t!="object"||typeof t.createPolicy!="function")return null;let r=null;const a="data-tt-policy-suffix";n&&n.hasAttribute(a)&&(r=n.getAttribute(a));const i="dompurify"+(r?"#"+r:"");try{return t.createPolicy(i,{createHTML(o){return o},createScriptURL(o){return o}})}catch{return console.warn("TrustedTypes policy "+i+" could not be created."),null}},Fn=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function ur(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:fa();const t=y=>ur(y);if(t.version="3.2.6",t.removed=[],!e||!e.document||e.document.nodeType!==Xe.document||!e.Element)return t.isSupported=!1,t;let{document:n}=e;const r=n,a=r.currentScript,{DocumentFragment:i,HTMLTemplateElement:o,Node:c,Element:l,NodeFilter:f,NamedNodeMap:d=e.NamedNodeMap||e.MozNamedAttrMap,HTMLFormElement:g,DOMParser:S,trustedTypes:p}=e,E=l.prototype,w=Ye(E,"cloneNode"),k=Ye(E,"remove"),Z=Ye(E,"nextSibling"),Te=Ye(E,"childNodes"),z=Ye(E,"parentNode");if(typeof o=="function"){const y=n.createElement("template");y.content&&y.content.ownerDocument&&(n=y.content.ownerDocument)}let I,Q="";const{implementation:me,createNodeIterator:Tt,createDocumentFragment:ae,getElementsByTagName:se}=n,{importNode:Re}=r;let v=Fn();t.isSupported=typeof ir=="function"&&typeof z=="function"&&me&&me.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:We,ERB_EXPR:_e,TMPLIT_EXPR:He,DATA_ATTR:ot,ARIA_ATTR:Rt,IS_SCRIPT_OR_DATA:be,ATTR_WHITESPACE:Fe,CUSTOM_ELEMENT:xr}=Hn;let{IS_ALLOWED_URI:on}=Hn,O=null;const cn=b({},[...kn,...Wt,...Ht,...Ft,...Kn]);let N=null;const ln=b({},[...Un,...$t,...Wn,...yt]);let _=Object.seal(or(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),$e=null,_t=null,un=!0,vt=!0,fn=!1,dn=!0,ve=!1,ct=!0,we=!1,xt=!1,Ct=!1,xe=!1,lt=!1,ut=!1,hn=!0,mn=!1;const Cr="user-content-";let It=!0,Je=!1,Ce={},Ie=null;const pn=b({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let yn=null;const gn=b({},["audio","video","img","source","image","track"]);let Ot=null;const Sn=b({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),ft="http://www.w3.org/1998/Math/MathML",dt="http://www.w3.org/2000/svg",ie="http://www.w3.org/1999/xhtml";let Oe=ie,Pt=!1,Lt=null;const Ir=b({},[ft,dt,ie],Ut);let ht=b({},["mi","mo","mn","ms","mtext"]),mt=b({},["annotation-xml"]);const Or=b({},["title","style","font","a","script"]);let Ge=null;const Pr=["application/xhtml+xml","text/html"],Lr="text/html";let P=null,Pe=null;const Nr=n.createElement("form"),En=function(s){return s instanceof RegExp||s instanceof Function},Nt=function(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(Pe&&Pe===s)){if((!s||typeof s!="object")&&(s={}),s=ue(s),Ge=Pr.indexOf(s.PARSER_MEDIA_TYPE)===-1?Lr:s.PARSER_MEDIA_TYPE,P=Ge==="application/xhtml+xml"?Ut:bt,O=X(s,"ALLOWED_TAGS")?b({},s.ALLOWED_TAGS,P):cn,N=X(s,"ALLOWED_ATTR")?b({},s.ALLOWED_ATTR,P):ln,Lt=X(s,"ALLOWED_NAMESPACES")?b({},s.ALLOWED_NAMESPACES,Ut):Ir,Ot=X(s,"ADD_URI_SAFE_ATTR")?b(ue(Sn),s.ADD_URI_SAFE_ATTR,P):Sn,yn=X(s,"ADD_DATA_URI_TAGS")?b(ue(gn),s.ADD_DATA_URI_TAGS,P):gn,Ie=X(s,"FORBID_CONTENTS")?b({},s.FORBID_CONTENTS,P):pn,$e=X(s,"FORBID_TAGS")?b({},s.FORBID_TAGS,P):ue({}),_t=X(s,"FORBID_ATTR")?b({},s.FORBID_ATTR,P):ue({}),Ce=X(s,"USE_PROFILES")?s.USE_PROFILES:!1,un=s.ALLOW_ARIA_ATTR!==!1,vt=s.ALLOW_DATA_ATTR!==!1,fn=s.ALLOW_UNKNOWN_PROTOCOLS||!1,dn=s.ALLOW_SELF_CLOSE_IN_ATTR!==!1,ve=s.SAFE_FOR_TEMPLATES||!1,ct=s.SAFE_FOR_XML!==!1,we=s.WHOLE_DOCUMENT||!1,xe=s.RETURN_DOM||!1,lt=s.RETURN_DOM_FRAGMENT||!1,ut=s.RETURN_TRUSTED_TYPE||!1,Ct=s.FORCE_BODY||!1,hn=s.SANITIZE_DOM!==!1,mn=s.SANITIZE_NAMED_PROPS||!1,It=s.KEEP_CONTENT!==!1,Je=s.IN_PLACE||!1,on=s.ALLOWED_URI_REGEXP||cr,Oe=s.NAMESPACE||ie,ht=s.MATHML_TEXT_INTEGRATION_POINTS||ht,mt=s.HTML_INTEGRATION_POINTS||mt,_=s.CUSTOM_ELEMENT_HANDLING||{},s.CUSTOM_ELEMENT_HANDLING&&En(s.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(_.tagNameCheck=s.CUSTOM_ELEMENT_HANDLING.tagNameCheck),s.CUSTOM_ELEMENT_HANDLING&&En(s.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(_.attributeNameCheck=s.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),s.CUSTOM_ELEMENT_HANDLING&&typeof s.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(_.allowCustomizedBuiltInElements=s.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),ve&&(vt=!1),lt&&(xe=!0),Ce&&(O=b({},Kn),N=[],Ce.html===!0&&(b(O,kn),b(N,Un)),Ce.svg===!0&&(b(O,Wt),b(N,$t),b(N,yt)),Ce.svgFilters===!0&&(b(O,Ht),b(N,$t),b(N,yt)),Ce.mathMl===!0&&(b(O,Ft),b(N,Wn),b(N,yt))),s.ADD_TAGS&&(O===cn&&(O=ue(O)),b(O,s.ADD_TAGS,P)),s.ADD_ATTR&&(N===ln&&(N=ue(N)),b(N,s.ADD_ATTR,P)),s.ADD_URI_SAFE_ATTR&&b(Ot,s.ADD_URI_SAFE_ATTR,P),s.FORBID_CONTENTS&&(Ie===pn&&(Ie=ue(Ie)),b(Ie,s.FORBID_CONTENTS,P)),It&&(O["#text"]=!0),we&&b(O,["html","head","body"]),O.table&&(b(O,["tbody"]),delete $e.tbody),s.TRUSTED_TYPES_POLICY){if(typeof s.TRUSTED_TYPES_POLICY.createHTML!="function")throw Ve('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof s.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw Ve('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');I=s.TRUSTED_TYPES_POLICY,Q=I.createHTML("")}else I===void 0&&(I=da(p,a)),I!==null&&typeof Q=="string"&&(Q=I.createHTML(""));H&&H(s),Pe=s}},bn=b({},[...Wt,...Ht,...ta]),wn=b({},[...Ft,...na]),Dr=function(s){let u=z(s);(!u||!u.tagName)&&(u={namespaceURI:Oe,tagName:"template"});const h=bt(s.tagName),R=bt(u.tagName);return Lt[s.namespaceURI]?s.namespaceURI===dt?u.namespaceURI===ie?h==="svg":u.namespaceURI===ft?h==="svg"&&(R==="annotation-xml"||ht[R]):!!bn[h]:s.namespaceURI===ft?u.namespaceURI===ie?h==="math":u.namespaceURI===dt?h==="math"&&mt[R]:!!wn[h]:s.namespaceURI===ie?u.namespaceURI===dt&&!mt[R]||u.namespaceURI===ft&&!ht[R]?!1:!wn[h]&&(Or[h]||!bn[h]):!!(Ge==="application/xhtml+xml"&&Lt[s.namespaceURI]):!1},j=function(s){Be(t.removed,{element:s});try{z(s).removeChild(s)}catch{k(s)}},Le=function(s,u){try{Be(t.removed,{attribute:u.getAttributeNode(s),from:u})}catch{Be(t.removed,{attribute:null,from:u})}if(u.removeAttribute(s),s==="is")if(xe||lt)try{j(u)}catch{}else try{u.setAttribute(s,"")}catch{}},An=function(s){let u=null,h=null;if(Ct)s="<remove></remove>"+s;else{const x=Mn(s,/^[\r\n\t ]+/);h=x&&x[0]}Ge==="application/xhtml+xml"&&Oe===ie&&(s='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+s+"</body></html>");const R=I?I.createHTML(s):s;if(Oe===ie)try{u=new S().parseFromString(R,Ge)}catch{}if(!u||!u.documentElement){u=me.createDocument(Oe,"template",null);try{u.documentElement.innerHTML=Pt?Q:R}catch{}}const K=u.body||u.documentElement;return s&&h&&K.insertBefore(n.createTextNode(h),K.childNodes[0]||null),Oe===ie?se.call(u,we?"html":"body")[0]:we?u.documentElement:K},Tn=function(s){return Tt.call(s.ownerDocument||s,s,f.SHOW_ELEMENT|f.SHOW_COMMENT|f.SHOW_TEXT|f.SHOW_PROCESSING_INSTRUCTION|f.SHOW_CDATA_SECTION,null)},Dt=function(s){return s instanceof g&&(typeof s.nodeName!="string"||typeof s.textContent!="string"||typeof s.removeChild!="function"||!(s.attributes instanceof d)||typeof s.removeAttribute!="function"||typeof s.setAttribute!="function"||typeof s.namespaceURI!="string"||typeof s.insertBefore!="function"||typeof s.hasChildNodes!="function")},Rn=function(s){return typeof c=="function"&&s instanceof c};function oe(y,s,u){pt(y,h=>{h.call(t,s,u,Pe)})}const _n=function(s){let u=null;if(oe(v.beforeSanitizeElements,s,null),Dt(s))return j(s),!0;const h=P(s.nodeName);if(oe(v.uponSanitizeElement,s,{tagName:h,allowedTags:O}),ct&&s.hasChildNodes()&&!Rn(s.firstElementChild)&&W(/<[/\w!]/g,s.innerHTML)&&W(/<[/\w!]/g,s.textContent)||s.nodeType===Xe.progressingInstruction||ct&&s.nodeType===Xe.comment&&W(/<[/\w]/g,s.data))return j(s),!0;if(!O[h]||$e[h]){if(!$e[h]&&xn(h)&&(_.tagNameCheck instanceof RegExp&&W(_.tagNameCheck,h)||_.tagNameCheck instanceof Function&&_.tagNameCheck(h)))return!1;if(It&&!Ie[h]){const R=z(s)||s.parentNode,K=Te(s)||s.childNodes;if(K&&R){const x=K.length;for(let J=x-1;J>=0;--J){const ce=w(K[J],!0);ce.__removalCount=(s.__removalCount||0)+1,R.insertBefore(ce,Z(s))}}}return j(s),!0}return s instanceof l&&!Dr(s)||(h==="noscript"||h==="noembed"||h==="noframes")&&W(/<\/no(script|embed|frames)/i,s.innerHTML)?(j(s),!0):(ve&&s.nodeType===Xe.text&&(u=s.textContent,pt([We,_e,He],R=>{u=qe(u,R," ")}),s.textContent!==u&&(Be(t.removed,{element:s.cloneNode()}),s.textContent=u)),oe(v.afterSanitizeElements,s,null),!1)},vn=function(s,u,h){if(hn&&(u==="id"||u==="name")&&(h in n||h in Nr))return!1;if(!(vt&&!_t[u]&&W(ot,u))){if(!(un&&W(Rt,u))){if(!N[u]||_t[u]){if(!(xn(s)&&(_.tagNameCheck instanceof RegExp&&W(_.tagNameCheck,s)||_.tagNameCheck instanceof Function&&_.tagNameCheck(s))&&(_.attributeNameCheck instanceof RegExp&&W(_.attributeNameCheck,u)||_.attributeNameCheck instanceof Function&&_.attributeNameCheck(u))||u==="is"&&_.allowCustomizedBuiltInElements&&(_.tagNameCheck instanceof RegExp&&W(_.tagNameCheck,h)||_.tagNameCheck instanceof Function&&_.tagNameCheck(h))))return!1}else if(!Ot[u]){if(!W(on,qe(h,Fe,""))){if(!((u==="src"||u==="xlink:href"||u==="href")&&s!=="script"&&Zr(h,"data:")===0&&yn[s])){if(!(fn&&!W(be,qe(h,Fe,"")))){if(h)return!1}}}}}}return!0},xn=function(s){return s!=="annotation-xml"&&Mn(s,xr)},Cn=function(s){oe(v.beforeSanitizeAttributes,s,null);const{attributes:u}=s;if(!u||Dt(s))return;const h={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:N,forceKeepAttr:void 0};let R=u.length;for(;R--;){const K=u[R],{name:x,namespaceURI:J,value:ce}=K,ze=P(x),Mt=ce;let U=x==="value"?Mt:Qr(Mt);if(h.attrName=ze,h.attrValue=U,h.keepAttr=!0,h.forceKeepAttr=void 0,oe(v.uponSanitizeAttribute,s,h),U=h.attrValue,mn&&(ze==="id"||ze==="name")&&(Le(x,s),U=Cr+U),ct&&W(/((--!?|])>)|<\/(style|title)/i,U)){Le(x,s);continue}if(h.forceKeepAttr)continue;if(!h.keepAttr){Le(x,s);continue}if(!dn&&W(/\/>/i,U)){Le(x,s);continue}ve&&pt([We,_e,He],On=>{U=qe(U,On," ")});const In=P(s.nodeName);if(!vn(In,ze,U)){Le(x,s);continue}if(I&&typeof p=="object"&&typeof p.getAttributeType=="function"&&!J)switch(p.getAttributeType(In,ze)){case"TrustedHTML":{U=I.createHTML(U);break}case"TrustedScriptURL":{U=I.createScriptURL(U);break}}if(U!==Mt)try{J?s.setAttributeNS(J,x,U):s.setAttribute(x,U),Dt(s)?j(s):Dn(t.removed)}catch{Le(x,s)}}oe(v.afterSanitizeAttributes,s,null)},Mr=function y(s){let u=null;const h=Tn(s);for(oe(v.beforeSanitizeShadowDOM,s,null);u=h.nextNode();)oe(v.uponSanitizeShadowNode,u,null),_n(u),Cn(u),u.content instanceof i&&y(u.content);oe(v.afterSanitizeShadowDOM,s,null)};return t.sanitize=function(y){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},u=null,h=null,R=null,K=null;if(Pt=!y,Pt&&(y="<!-->"),typeof y!="string"&&!Rn(y))if(typeof y.toString=="function"){if(y=y.toString(),typeof y!="string")throw Ve("dirty is not a string, aborting")}else throw Ve("toString is not a function");if(!t.isSupported)return y;if(xt||Nt(s),t.removed=[],typeof y=="string"&&(Je=!1),Je){if(y.nodeName){const ce=P(y.nodeName);if(!O[ce]||$e[ce])throw Ve("root node is forbidden and cannot be sanitized in-place")}}else if(y instanceof c)u=An("<!---->"),h=u.ownerDocument.importNode(y,!0),h.nodeType===Xe.element&&h.nodeName==="BODY"||h.nodeName==="HTML"?u=h:u.appendChild(h);else{if(!xe&&!ve&&!we&&y.indexOf("<")===-1)return I&&ut?I.createHTML(y):y;if(u=An(y),!u)return xe?null:ut?Q:""}u&&Ct&&j(u.firstChild);const x=Tn(Je?y:u);for(;R=x.nextNode();)_n(R),Cn(R),R.content instanceof i&&Mr(R.content);if(Je)return y;if(xe){if(lt)for(K=ae.call(u.ownerDocument);u.firstChild;)K.appendChild(u.firstChild);else K=u;return(N.shadowroot||N.shadowrootmode)&&(K=Re.call(r,K,!0)),K}let J=we?u.outerHTML:u.innerHTML;return we&&O["!doctype"]&&u.ownerDocument&&u.ownerDocument.doctype&&u.ownerDocument.doctype.name&&W(lr,u.ownerDocument.doctype.name)&&(J="<!DOCTYPE "+u.ownerDocument.doctype.name+`>
`+J),ve&&pt([We,_e,He],ce=>{J=qe(J,ce," ")}),I&&ut?I.createHTML(J):J},t.setConfig=function(){let y=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Nt(y),xt=!0},t.clearConfig=function(){Pe=null,xt=!1},t.isValidAttribute=function(y,s,u){Pe||Nt({});const h=P(y),R=P(s);return vn(h,R,u)},t.addHook=function(y,s){typeof s=="function"&&Be(v[y],s)},t.removeHook=function(y,s){if(s!==void 0){const u=Yr(v[y],s);return u===-1?void 0:Xr(v[y],u,1)[0]}return Dn(v[y])},t.removeHooks=function(y){v[y]=[]},t.removeAllHooks=function(){v=Fn()},t}var ha=ur();class Jt{constructor(){this.queue=[],this.cache=null}combine(t,n){return[t[0]*n[0]+t[2]*n[1],t[1]*n[0]+t[3]*n[1],t[0]*n[2]+t[2]*n[3],t[1]*n[2]+t[3]*n[3],t[0]*n[4]+t[2]*n[5]+t[4],t[1]*n[4]+t[3]*n[5]+t[5]]}isIdentity(){this.cache||(this.cache=this.toArray());const t=this.cache;return t[0]===1&&t[1]===0&&t[2]===0&&t[3]===1&&t[4]===0&&t[5]===0}matrix(t){return t[0]===1&&t[1]===0&&t[2]===0&&t[3]===1&&t[4]===0&&t[5]===0?this:(this.cache=null,this.queue.push(t),this)}translate(t,n){return(t!==0||n!==0)&&(this.cache=null,this.queue.push([1,0,0,1,t,n])),this}scale(t,n){return(t!==1||n!==1)&&(this.cache=null,this.queue.push([t,0,0,n,0,0])),this}rotate(t,n,r){if(t!==0){this.translate(n,r);const a=t*Math.PI/180,i=Math.cos(a),o=Math.sin(a);this.queue.push([i,o,-o,i,0,0]),this.cache=null,this.translate(-n,-r)}return this}skewX(t){return t!==0&&(this.cache=null,this.queue.push([1,0,Math.tan(t*Math.PI/180),1,0,0])),this}skewY(t){return t!==0&&(this.cache=null,this.queue.push([1,Math.tan(t*Math.PI/180),0,1,0,0])),this}toArray(){if(this.cache)return this.cache;if(!this.queue.length)return this.cache=[1,0,0,1,0,0],this.cache;if(this.cache=this.queue[0],this.queue.length===1)return this.cache;for(let t=1;t<this.queue.length;t++)this.cache=this.combine(this.cache,this.queue[t]);return this.cache}calc(t,n,r=!1){if(!this.queue.length)return[t,n];this.cache||(this.cache=this.toArray());const a=this.cache;return[t*a[0]+n*a[2]+(r?0:a[4]),t*a[1]+n*a[3]+(r?0:a[5])]}}const De=1e-9;function C(e,t,n=De){return Math.abs(e-t)<n}function $n(e,t,n){const r=e.x-t.x,a=e.y-t.y;return r*r+a*a<n*n}function gt(e){return e*(Math.PI/180)}function Jn(e){return e*(180/Math.PI)}function ma(e,t,n){if(C(e.x,t.x)&&C(n.x,e.x))return!C(n.y,t.y)&&!C(n.y,e.y)&&n.y<Math.max(t.y,e.y)&&n.y>Math.min(t.y,e.y);if(C(e.y,t.y)&&C(n.y,e.y))return!C(n.x,t.x)&&!C(n.x,e.x)&&n.x<Math.max(t.x,e.x)&&n.x>Math.min(t.x,e.x);if(n.x<e.x&&n.x<t.x||n.x>e.x&&n.x>t.x||n.y<e.y&&n.y<t.y||n.y>e.y&&n.y>t.y||C(n.x,e.x)&&C(n.y,e.y)||C(n.x,t.x)&&C(n.y,t.y))return!1;const r=(n.y-e.y)*(t.x-e.x)-(n.x-e.x)*(t.y-e.y);if(Math.abs(r)>De)return!1;const a=(n.x-e.x)*(t.x-e.x)+(n.y-e.y)*(t.y-e.y);if(a<0||C(a,0))return!1;const i=(t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y);return!(a>i||C(a,i))}function pa(e,t,n,r,a){const i=t.y-e.y,o=e.x-t.x,c=t.x*e.y-e.x*t.y,l=r.y-n.y,f=n.x-r.x,d=r.x*n.y-n.x*r.y,g=i*f-l*o,S=(o*d-f*c)/g,p=(l*c-i*d)/g;return!isFinite(S)||!isFinite(p)||!a&&(Math.abs(e.x-t.x)>De&&(e.x<t.x?S<e.x||S>t.x:S>e.x||S<t.x)||Math.abs(e.y-t.y)>De&&(e.y<t.y?p<e.y||p>t.y:p>e.y||p<t.y)||Math.abs(n.x-r.x)>De&&(n.x<r.x?S<n.x||S>r.x:S>n.x||S<r.x)||Math.abs(n.y-r.y)>De&&(n.y<r.y?p<n.y||p>r.y:p>n.y||p<r.y))?null:{x:S,y:p}}const Gn={withinDistance:$n,lineIntersect:pa,almostEqual:C,QuadraticBezier:{isFlat:function(e,t,n,r){r=4*r*r;let a=2*n.x-e.x-t.x;a*=a;let i=2*n.y-e.y-t.y;return i*=i,a+i<=r},linearize:function(e,t,n,r){const a=[e],i=[{p1:e,p2:t,c1:n}];for(;i.length>0;){const o=i[0];if(this.isFlat(o.p1,o.p2,o.c1,r))a.push({x:o.p2.x,y:o.p2.y}),i.shift();else{const c=this.subdivide(o.p1,o.p2,o.c1,.5);i.splice(0,1,c[0],c[1])}}return a},subdivide:function(e,t,n,r){const a={x:e.x+(n.x-e.x)*r,y:e.y+(n.y-e.y)*r},i={x:n.x+(t.x-n.x)*r,y:n.y+(t.y-n.y)*r},o={x:a.x+(i.x-a.x)*r,y:a.y+(i.y-a.y)*r};return[{p1:e,p2:o,c1:a},{p1:o,p2:t,c1:i}]}},CubicBezier:{isFlat:function(e,t,n,r,a){a=16*a*a;let i=3*n.x-2*e.x-t.x;i*=i;let o=3*n.y-2*e.y-t.y;o*=o;let c=3*r.x-2*t.x-e.x;c*=c;let l=3*r.y-2*t.y-e.y;return l*=l,i<c&&(i=c),o<l&&(o=l),i+o<=a},linearize:function(e,t,n,r,a){const i=[e],o=[{p1:e,p2:t,c1:n,c2:r}];for(;o.length>0;){const c=o[0];if(this.isFlat(c.p1,c.p2,c.c1,c.c2,a))i.push({x:c.p2.x,y:c.p2.y}),o.shift();else{const l=this.subdivide(c.p1,c.p2,c.c1,c.c2,.5);o.splice(0,1,l[0],l[1])}}return i},subdivide:function(e,t,n,r,a){const i={x:e.x+(n.x-e.x)*a,y:e.y+(n.y-e.y)*a},o={x:r.x+(t.x-r.x)*a,y:r.y+(t.y-r.y)*a},c={x:n.x+(r.x-n.x)*a,y:n.y+(r.y-n.y)*a},l={x:i.x+(c.x-i.x)*a,y:i.y+(c.y-i.y)*a},f={x:c.x+(o.x-c.x)*a,y:c.y+(o.y-c.y)*a},d={x:l.x+(f.x-l.x)*a,y:l.y+(f.y-l.y)*a};return[{p1:e,p2:d,c1:i,c2:l},{p1:d,p2:t,c1:f,c2:o}]}},Arc:{linearize:function(e,t,n,r,a,i,o,c){const l=[t];let f=this.svgToCenter(e,t,n,r,a,i,o);const d=[f];for(;d.length>0;){f=d[0];const g=this.centerToSvg(f.center,f.rx,f.ry,f.theta,f.extent,f.angle),p=this.centerToSvg(f.center,f.rx,f.ry,f.theta,.5*f.extent,f.angle).p2,E={x:.5*(g.p1.x+g.p2.x),y:.5*(g.p1.y+g.p2.y)};if($n(E,p,c))l.unshift(g.p2),d.shift();else{const w={...f,extent:.5*f.extent},k={...f,theta:f.theta+.5*f.extent,extent:.5*f.extent};d.splice(0,1,w,k)}}return l},centerToSvg:function(e,t,n,r,a,i){const o=r+a,c=gt(r),l=gt(o),f=gt(i),d=Math.cos(f),g=Math.sin(f),S=Math.cos(c),p=Math.sin(c),E=Math.cos(l),w=Math.sin(l),k=e.x+d*t*S+-g*n*p,Z=e.y+g*t*S+d*n*p,Te=e.x+d*t*E+-g*n*w,z=e.y+g*t*E+d*n*w;return{p1:{x:k,y:Z},p2:{x:Te,y:z},rx:t,ry:n,angle:i,largearc:a>180?1:0,sweep:a>0?1:0}},svgToCenter:function(e,t,n,r,a,i,o){const c={x:.5*(e.x-t.x),y:.5*(e.y-t.y)},l=gt(a%360),f=Math.cos(l),d=Math.sin(l),g=f*c.x+d*c.y,S=-d*c.x+f*c.y;n=Math.abs(n),r=Math.abs(r);let p=n*n,E=r*r,w=g*g,k=S*S;const Z=w/p+k/E;if(Z>1){const Fe=Math.sqrt(Z);n=Fe*n,r=Fe*r,p=n*n,E=r*r}const Te=i===o?-1:1;let z=(p*E-p*k-E*w)/(p*k+E*w);z=z<0?0:z;const I=Te*Math.sqrt(z),Q=I*(n*S/r),me=I*-(r*g/n),Tt={x:(e.x+t.x)/2+(f*Q-d*me),y:(e.y+t.y)/2+(d*Q+f*me)},ae=(g-Q)/n,se=(S-me)/r,Re=(-g-Q)/n,v=(-S-me)/r,We=Math.sqrt(ae*ae+se*se);let _e=Math.acos(ae/We);se<0&&(_e*=-1);const He=Math.sqrt((ae*ae+se*se)*(Re*Re+v*v));let ot=Math.acos((ae*Re+se*v)/He);ae*v-se*Re<0&&(ot*=-1);let Rt=Jn(_e),be=Jn(ot%(2*Math.PI));return!o&&be>0&&(be-=360),o&&be<0&&(be+=360),{center:Tt,rx:n,ry:r,theta:Rt,extent:be,angle:a}}},getPolygonBounds:function(e){if(!e||e.length<1)return null;let t=e[0].x,n=e[0].x,r=e[0].y,a=e[0].y;for(let i=1;i<e.length;i++)e[i].x>n?n=e[i].x:e[i].x<t&&(t=e[i].x),e[i].y>a?a=e[i].y:e[i].y<r&&(r=e[i].y);return{x:t,y:r,width:n-t,height:a-r}},pointInPolygon:function(e,t){if(!t||t.length<3)return null;let n=!1;const r=t.offsetx||0,a=t.offsety||0;for(let i=0,o=t.length-1;i<t.length;o=i++){const c=t[i].x+r,l=t[i].y+a,f=t[o].x+r,d=t[o].y+a;if(C(c,e.x)&&C(l,e.y)||ma({x:c,y:l},{x:f,y:d},e))return null;if(C(c,f)&&C(l,d))continue;l>e.y!=d>e.y&&e.x<(f-c)*(e.y-l)/(d-l)+c&&(n=!n)}return n},polygonArea:function(e){let t=0;for(let n=0,r=e.length-1;n<e.length;r=n++)t+=(e[r].x+e[n].x)*(e[r].y-e[n].y);return .5*t}};class ya{constructor(){this.svg=null,this.svgRoot=null,this.allowedElements=["svg","circle","ellipse","path","polygon","polyline","rect","line"],this.conf={tolerance:2,toleranceSvg:.005}}config(t){t&&t.tolerance&&(this.conf.tolerance=t.tolerance)}load(t){if(!t||typeof t!="string")throw new Error("Invalid SVG string");const r=new DOMParser().parseFromString(t,"image/svg+xml");if(!r||r.querySelector("parsererror"))throw new Error("Failed to parse SVG string");if(this.svg=r,this.svgRoot=r.querySelector("svg"),!this.svgRoot)throw new Error("No SVG root element found in the provided string");return this.svgRoot}cleanInput(){return this.svgRoot?(this.applyTransform(this.svgRoot),this.flatten(this.svgRoot),this.filter(this.allowedElements),this.recurse(this.svgRoot,t=>this.splitPath(t)),this.svgRoot):null}getStyle(){return this.svgRoot?this.svgRoot.querySelector("style"):!1}pathToAbsolute(t){if(!t||t.tagName!=="path"||!t.pathSegList){console.warn("SvgParser.pathToAbsolute: pathSegList API is deprecated and may not be supported.");return}let n=0,r=0,a=0,i=0;const o=t.pathSegList;for(let c=0;c<o.numberOfItems;c++){const l=o.getItem(c),f=l.pathSegTypeAsLetter;if(/[MLHVCSQTA]/.test(f))"x"in l&&(n=l.x),"y"in l&&(r=l.y);else{let d="x1"in l?n+l.x1:0,g="y1"in l?r+l.y1:0,S="x2"in l?n+l.x2:0,p="y2"in l?r+l.y2:0;switch("x"in l&&(n+=l.x),"y"in l&&(r+=l.y),f){case"m":o.replaceItem(t.createSVGPathSegMovetoAbs(n,r),c);break;case"l":o.replaceItem(t.createSVGPathSegLinetoAbs(n,r),c);break;case"h":o.replaceItem(t.createSVGPathSegLinetoHorizontalAbs(n),c);break;case"v":o.replaceItem(t.createSVGPathSegLinetoVerticalAbs(r),c);break;case"c":o.replaceItem(t.createSVGPathSegCurvetoCubicAbs(n,r,d,g,S,p),c);break;case"s":o.replaceItem(t.createSVGPathSegCurvetoCubicSmoothAbs(n,r,S,p),c);break;case"q":o.replaceItem(t.createSVGPathSegCurvetoQuadraticAbs(n,r,d,g),c);break;case"t":o.replaceItem(t.createSVGPathSegCurvetoQuadraticSmoothAbs(n,r),c);break;case"a":o.replaceItem(t.createSVGPathSegArcAbs(n,r,l.r1,l.r2,l.angle,l.largeArcFlag,l.sweepFlag),c);break;case"z":case"Z":n=a,r=i;break}}f.toUpperCase()==="M"&&(a=n,i=r)}}transformParse(t){const n=/\s*(matrix|translate|scale|rotate|skewX|skewY)\s*\(\s*(.*?)\s*\)[\s,]*/,r=/[\s,]+/,a=new Jt;let i="";return t.split(n).forEach(o=>{if(!o||!o.length)return;if(["matrix","translate","scale","rotate","skewX","skewY"].includes(o)){i=o;return}const c=o.split(r).map(l=>+l||0);switch(i){case"matrix":c.length===6&&a.matrix(c);break;case"scale":a.scale(c[0],c.length>1?c[1]:c[0]);break;case"rotate":a.rotate(c[0],c[1]||0,c[2]||0);break;case"translate":a.translate(c[0],c[1]||0);break;case"skewX":c.length===1&&a.skewX(c[0]);break;case"skewY":c.length===1&&a.skewY(c[0]);break}}),a}applyTransform(t,n=new Jt){const r=t.getAttribute("transform");let a=n;if(r){const i=this.transformParse(r);a=new Jt;const o=a.combine(n.toArray(),i.toArray());a.matrix(o)}["g","svg","defs"].includes(t.tagName)?t.removeAttribute("transform"):a.isIdentity()||(console.warn(`Applying transform to <${t.tagName}>. For full accuracy, convert shape to path first.`),t.removeAttribute("transform"));for(const i of Array.from(t.children))this.applyTransform(i,a)}flatten(t){if(t.tagName==="g"&&t.parentElement){for(;t.firstChild;)t.parentElement.insertBefore(t.firstChild,t);t.parentElement.removeChild(t)}for(const n of Array.from(t.children))this.flatten(n)}filter(t,n=this.svgRoot){const r=Array.from(n.children);for(const a of r)this.filter(t,a);!t.includes(n.tagName)&&n.parentElement&&n.parentElement.removeChild(n)}splitPath(t){if(t.tagName!=="path"||!t.parentElement||!t.pathSegList)return;const n=Array.from(t.pathSegList);if(n.filter(i=>i.pathSegTypeAsLetter.toUpperCase()==="M").length<=1)return;const r=[];let a=null;n.forEach(i=>{if(i.pathSegTypeAsLetter.toUpperCase()==="M"){a=t.cloneNode(!1),a.setAttribute("d","");for(const c of t.attributes)c.name!=="d"&&a.setAttribute(c.name,c.value);r.push(a)}a.pathSegList.appendItem(i)}),r.forEach(i=>t.parentElement.insertBefore(i,t)),t.parentElement.removeChild(t)}recurse(t,n){Array.from(t.children).forEach(a=>this.recurse(a,n)),n(t)}polygonify(t){const n=[];switch(t.tagName){case"polygon":case"polyline":for(const S of t.points)n.push({x:S.x,y:S.y});break;case"rect":const r=parseFloat(t.getAttribute("x"))||0,a=parseFloat(t.getAttribute("y"))||0,i=parseFloat(t.getAttribute("width")),o=parseFloat(t.getAttribute("height"));n.push({x:r,y:a},{x:r+i,y:a},{x:r+i,y:a+o},{x:r,y:a+o});break;case"circle":case"ellipse":const c=parseFloat(t.getAttribute("cx")),l=parseFloat(t.getAttribute("cy")),f=parseFloat(t.getAttribute("rx")||t.getAttribute("r")),d=parseFloat(t.getAttribute("ry")||t.getAttribute("r")),g=Math.ceil(2*Math.PI/Math.acos(1-this.conf.tolerance/Math.max(f,d)));for(let S=0;S<Math.max(g,3);S++){const p=S*(2*Math.PI)/g;n.push({x:f*Math.cos(p)+c,y:d*Math.sin(p)+l})}break;case"path":console.warn("Polygonify for <path> elements is complex and not fully implemented in this version.");break}return n.length>1&&Gn.almostEqual(n[0].x,n[n.length-1].x,this.conf.toleranceSvg)&&Gn.almostEqual(n[0].y,n[n.length-1].y,this.conf.toleranceSvg)&&n.pop(),n}}const St=new TextEncoder,je=new TextDecoder;function ga(...e){const t=e.reduce((a,{length:i})=>a+i,0),n=new Uint8Array(t);let r=0;for(const a of e)n.set(a,r),r+=a.length;return n}function Sa(e){if(Uint8Array.fromBase64)return Uint8Array.fromBase64(e);const t=atob(e),n=new Uint8Array(t.length);for(let r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return n}function Qe(e){if(Uint8Array.fromBase64)return Uint8Array.fromBase64(typeof e=="string"?e:je.decode(e),{alphabet:"base64url"});let t=e;t instanceof Uint8Array&&(t=je.decode(t)),t=t.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return Sa(t)}catch{throw new TypeError("The input to be decoded is not correctly encoded.")}}class q extends Error{constructor(n,r){var a;super(n,r);T(this,"code","ERR_JOSE_GENERIC");this.name=this.constructor.name,(a=Error.captureStackTrace)==null||a.call(Error,this,this.constructor)}}T(q,"code","ERR_JOSE_GENERIC");class Y extends q{constructor(n,r,a="unspecified",i="unspecified"){super(n,{cause:{claim:a,reason:i,payload:r}});T(this,"code","ERR_JWT_CLAIM_VALIDATION_FAILED");T(this,"claim");T(this,"reason");T(this,"payload");this.claim=a,this.reason=i,this.payload=r}}T(Y,"code","ERR_JWT_CLAIM_VALIDATION_FAILED");class Vt extends q{constructor(n,r,a="unspecified",i="unspecified"){super(n,{cause:{claim:a,reason:i,payload:r}});T(this,"code","ERR_JWT_EXPIRED");T(this,"claim");T(this,"reason");T(this,"payload");this.claim=a,this.reason=i,this.payload=r}}T(Vt,"code","ERR_JWT_EXPIRED");class re extends q{constructor(){super(...arguments);T(this,"code","ERR_JOSE_NOT_SUPPORTED")}}T(re,"code","ERR_JOSE_NOT_SUPPORTED");class L extends q{constructor(){super(...arguments);T(this,"code","ERR_JWS_INVALID")}}T(L,"code","ERR_JWS_INVALID");class jt extends q{constructor(){super(...arguments);T(this,"code","ERR_JWT_INVALID")}}T(jt,"code","ERR_JWT_INVALID");class en extends q{constructor(){super(...arguments);T(this,"code","ERR_JWKS_INVALID")}}T(en,"code","ERR_JWKS_INVALID");class tn extends q{constructor(n="no applicable key found in the JSON Web Key Set",r){super(n,r);T(this,"code","ERR_JWKS_NO_MATCHING_KEY")}}T(tn,"code","ERR_JWKS_NO_MATCHING_KEY");var jn,er;class fr extends(er=q,jn=Symbol.asyncIterator,er){constructor(n="multiple matching keys found in the JSON Web Key Set",r){super(n,r);T(this,jn);T(this,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS")}}T(fr,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS");class dr extends q{constructor(n="request timed out",r){super(n,r);T(this,"code","ERR_JWKS_TIMEOUT")}}T(dr,"code","ERR_JWKS_TIMEOUT");class hr extends q{constructor(n="signature verification failed",r){super(n,r);T(this,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED")}}T(hr,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED");function le(e,t="algorithm.name"){return new TypeError(`CryptoKey does not support this operation, its ${t} must be ${e}`)}function Ze(e,t){return e.name===t}function Gt(e){return parseInt(e.name.slice(4),10)}function Ea(e){switch(e){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw new Error("unreachable")}}function ba(e,t){if(!e.usages.includes(t))throw new TypeError(`CryptoKey does not support this operation, its usages must include ${t}.`)}function wa(e,t,n){switch(t){case"HS256":case"HS384":case"HS512":{if(!Ze(e.algorithm,"HMAC"))throw le("HMAC");const r=parseInt(t.slice(2),10);if(Gt(e.algorithm.hash)!==r)throw le(`SHA-${r}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!Ze(e.algorithm,"RSASSA-PKCS1-v1_5"))throw le("RSASSA-PKCS1-v1_5");const r=parseInt(t.slice(2),10);if(Gt(e.algorithm.hash)!==r)throw le(`SHA-${r}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!Ze(e.algorithm,"RSA-PSS"))throw le("RSA-PSS");const r=parseInt(t.slice(2),10);if(Gt(e.algorithm.hash)!==r)throw le(`SHA-${r}`,"algorithm.hash");break}case"Ed25519":case"EdDSA":{if(!Ze(e.algorithm,"Ed25519"))throw le("Ed25519");break}case"ES256":case"ES384":case"ES512":{if(!Ze(e.algorithm,"ECDSA"))throw le("ECDSA");const r=Ea(t);if(e.algorithm.namedCurve!==r)throw le(r,"algorithm.namedCurve");break}default:throw new TypeError("CryptoKey does not support this operation")}ba(e,n)}function mr(e,t,...n){var r;if(n=n.filter(Boolean),n.length>2){const a=n.pop();e+=`one of type ${n.join(", ")}, or ${a}.`}else n.length===2?e+=`one of type ${n[0]} or ${n[1]}.`:e+=`of type ${n[0]}.`;return t==null?e+=` Received ${t}`:typeof t=="function"&&t.name?e+=` Received function ${t.name}`:typeof t=="object"&&t!=null&&(r=t.constructor)!=null&&r.name&&(e+=` Received an instance of ${t.constructor.name}`),e}const Aa=(e,...t)=>mr("Key must be ",e,...t);function pr(e,t,...n){return mr(`Key for the ${e} algorithm must be `,t,...n)}function yr(e){return(e==null?void 0:e[Symbol.toStringTag])==="CryptoKey"}function gr(e){return(e==null?void 0:e[Symbol.toStringTag])==="KeyObject"}const Sr=e=>yr(e)||gr(e),Ta=(...e)=>{const t=e.filter(Boolean);if(t.length===0||t.length===1)return!0;let n;for(const r of t){const a=Object.keys(r);if(!n||n.size===0){n=new Set(a);continue}for(const i of a){if(n.has(i))return!1;n.add(i)}}return!0};function Ra(e){return typeof e=="object"&&e!==null}const ge=e=>{if(!Ra(e)||Object.prototype.toString.call(e)!=="[object Object]")return!1;if(Object.getPrototypeOf(e)===null)return!0;let t=e;for(;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t},_a=(e,t)=>{if(e.startsWith("RS")||e.startsWith("PS")){const{modulusLength:n}=t.algorithm;if(typeof n!="number"||n<2048)throw new TypeError(`${e} requires key modulusLength to be 2048 bits or larger`)}};function va(e){let t,n;switch(e.kty){case"RSA":{switch(e.alg){case"PS256":case"PS384":case"PS512":t={name:"RSA-PSS",hash:`SHA-${e.alg.slice(-3)}`},n=e.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":t={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${e.alg.slice(-3)}`},n=e.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":t={name:"RSA-OAEP",hash:`SHA-${parseInt(e.alg.slice(-3),10)||1}`},n=e.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new re('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"EC":{switch(e.alg){case"ES256":t={name:"ECDSA",namedCurve:"P-256"},n=e.d?["sign"]:["verify"];break;case"ES384":t={name:"ECDSA",namedCurve:"P-384"},n=e.d?["sign"]:["verify"];break;case"ES512":t={name:"ECDSA",namedCurve:"P-521"},n=e.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":t={name:"ECDH",namedCurve:e.crv},n=e.d?["deriveBits"]:[];break;default:throw new re('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"OKP":{switch(e.alg){case"Ed25519":case"EdDSA":t={name:"Ed25519"},n=e.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":t={name:e.crv},n=e.d?["deriveBits"]:[];break;default:throw new re('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}default:throw new re('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:t,keyUsages:n}}const Er=async e=>{if(!e.alg)throw new TypeError('"alg" argument is required when "jwk.alg" is not present');const{algorithm:t,keyUsages:n}=va(e),r={...e};return delete r.alg,delete r.use,crypto.subtle.importKey("jwk",r,t,e.ext??!e.d,e.key_ops??n)};async function xa(e,t,n){if(!ge(e))throw new TypeError("JWK must be an object");let r;switch(t??(t=e.alg),r??(r=e.ext),e.kty){case"oct":if(typeof e.k!="string"||!e.k)throw new TypeError('missing "k" (Key Value) Parameter value');return Qe(e.k);case"RSA":if("oth"in e&&e.oth!==void 0)throw new re('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');case"EC":case"OKP":return Er({...e,alg:t,ext:r});default:throw new re('Unsupported "kty" (Key Type) Parameter value')}}const Ca=(e,t,n,r,a)=>{if(a.crit!==void 0&&(r==null?void 0:r.crit)===void 0)throw new e('"crit" (Critical) Header Parameter MUST be integrity protected');if(!r||r.crit===void 0)return new Set;if(!Array.isArray(r.crit)||r.crit.length===0||r.crit.some(o=>typeof o!="string"||o.length===0))throw new e('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');let i;i=t;for(const o of r.crit){if(!i.has(o))throw new re(`Extension Header Parameter "${o}" is not recognized`);if(a[o]===void 0)throw new e(`Extension Header Parameter "${o}" is missing`);if(i.get(o)&&r[o]===void 0)throw new e(`Extension Header Parameter "${o}" MUST be integrity protected`)}return new Set(r.crit)};function nn(e){return ge(e)&&typeof e.kty=="string"}function Ia(e){return e.kty!=="oct"&&typeof e.d=="string"}function Oa(e){return e.kty!=="oct"&&typeof e.d>"u"}function Pa(e){return e.kty==="oct"&&typeof e.k=="string"}let Me;const zn=async(e,t,n,r=!1)=>{Me||(Me=new WeakMap);let a=Me.get(e);if(a!=null&&a[n])return a[n];const i=await Er({...t,alg:n});return r&&Object.freeze(e),a?a[n]=i:Me.set(e,{[n]:i}),i},La=(e,t)=>{var o;Me||(Me=new WeakMap);let n=Me.get(e);if(n!=null&&n[t])return n[t];const r=e.type==="public",a=!!r;let i;if(e.asymmetricKeyType==="x25519"){switch(t){case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":break;default:throw new TypeError("given KeyObject instance cannot be used for this algorithm")}i=e.toCryptoKey(e.asymmetricKeyType,a,r?[]:["deriveBits"])}if(e.asymmetricKeyType==="ed25519"){if(t!=="EdDSA"&&t!=="Ed25519")throw new TypeError("given KeyObject instance cannot be used for this algorithm");i=e.toCryptoKey(e.asymmetricKeyType,a,[r?"verify":"sign"])}if(e.asymmetricKeyType==="rsa"){let c;switch(t){case"RSA-OAEP":c="SHA-1";break;case"RS256":case"PS256":case"RSA-OAEP-256":c="SHA-256";break;case"RS384":case"PS384":case"RSA-OAEP-384":c="SHA-384";break;case"RS512":case"PS512":case"RSA-OAEP-512":c="SHA-512";break;default:throw new TypeError("given KeyObject instance cannot be used for this algorithm")}if(t.startsWith("RSA-OAEP"))return e.toCryptoKey({name:"RSA-OAEP",hash:c},a,r?["encrypt"]:["decrypt"]);i=e.toCryptoKey({name:t.startsWith("PS")?"RSA-PSS":"RSASSA-PKCS1-v1_5",hash:c},a,[r?"verify":"sign"])}if(e.asymmetricKeyType==="ec"){const l=new Map([["prime256v1","P-256"],["secp384r1","P-384"],["secp521r1","P-521"]]).get((o=e.asymmetricKeyDetails)==null?void 0:o.namedCurve);if(!l)throw new TypeError("given KeyObject instance cannot be used for this algorithm");t==="ES256"&&l==="P-256"&&(i=e.toCryptoKey({name:"ECDSA",namedCurve:l},a,[r?"verify":"sign"])),t==="ES384"&&l==="P-384"&&(i=e.toCryptoKey({name:"ECDSA",namedCurve:l},a,[r?"verify":"sign"])),t==="ES512"&&l==="P-521"&&(i=e.toCryptoKey({name:"ECDSA",namedCurve:l},a,[r?"verify":"sign"])),t.startsWith("ECDH-ES")&&(i=e.toCryptoKey({name:"ECDH",namedCurve:l},a,r?[]:["deriveBits"]))}if(!i)throw new TypeError("given KeyObject instance cannot be used for this algorithm");return n?n[t]=i:Me.set(e,{[t]:i}),i},Na=async(e,t)=>{if(e instanceof Uint8Array||yr(e))return e;if(gr(e)){if(e.type==="secret")return e.export();if("toCryptoKey"in e&&typeof e.toCryptoKey=="function")try{return La(e,t)}catch(r){if(r instanceof TypeError)throw r}let n=e.export({format:"jwk"});return zn(e,n,t)}if(nn(e))return e.k?Qe(e.k):zn(e,e,t,!0);throw new Error("unreachable")},Ne=e=>e==null?void 0:e[Symbol.toStringTag],Yt=(e,t,n)=>{var r,a;if(t.use!==void 0){let i;switch(n){case"sign":case"verify":i="sig";break;case"encrypt":case"decrypt":i="enc";break}if(t.use!==i)throw new TypeError(`Invalid key for this operation, its "use" must be "${i}" when present`)}if(t.alg!==void 0&&t.alg!==e)throw new TypeError(`Invalid key for this operation, its "alg" must be "${e}" when present`);if(Array.isArray(t.key_ops)){let i;switch(!0){case n==="verify":case e==="dir":case e.includes("CBC-HS"):i=n;break;case e.startsWith("PBES2"):i="deriveBits";break;case/^A\d{3}(?:GCM)?(?:KW)?$/.test(e):!e.includes("GCM")&&e.endsWith("KW")?i="unwrapKey":i=n;break;case n==="encrypt":i="wrapKey";break;case n==="decrypt":i=e.startsWith("RSA")?"unwrapKey":"deriveBits";break}if(i&&((a=(r=t.key_ops)==null?void 0:r.includes)==null?void 0:a.call(r,i))===!1)throw new TypeError(`Invalid key for this operation, its "key_ops" must include "${i}" when present`)}return!0},Da=(e,t,n)=>{if(!(t instanceof Uint8Array)){if(nn(t)){if(Pa(t)&&Yt(e,t,n))return;throw new TypeError('JSON Web Key for symmetric algorithms must have JWK "kty" (Key Type) equal to "oct" and the JWK "k" (Key Value) present')}if(!Sr(t))throw new TypeError(pr(e,t,"CryptoKey","KeyObject","JSON Web Key","Uint8Array"));if(t.type!=="secret")throw new TypeError(`${Ne(t)} instances for symmetric algorithms must be of type "secret"`)}},Ma=(e,t,n)=>{if(nn(t))switch(n){case"decrypt":case"sign":if(Ia(t)&&Yt(e,t,n))return;throw new TypeError("JSON Web Key for this operation be a private JWK");case"encrypt":case"verify":if(Oa(t)&&Yt(e,t,n))return;throw new TypeError("JSON Web Key for this operation be a public JWK")}if(!Sr(t))throw new TypeError(pr(e,t,"CryptoKey","KeyObject","JSON Web Key"));if(t.type==="secret")throw new TypeError(`${Ne(t)} instances for asymmetric algorithms must not be of type "secret"`);if(t.type==="public")switch(n){case"sign":throw new TypeError(`${Ne(t)} instances for asymmetric algorithm signing must be of type "private"`);case"decrypt":throw new TypeError(`${Ne(t)} instances for asymmetric algorithm decryption must be of type "private"`)}if(t.type==="private")switch(n){case"verify":throw new TypeError(`${Ne(t)} instances for asymmetric algorithm verifying must be of type "public"`);case"encrypt":throw new TypeError(`${Ne(t)} instances for asymmetric algorithm encryption must be of type "public"`)}},ka=(e,t,n)=>{e.startsWith("HS")||e==="dir"||e.startsWith("PBES2")||/^A(?:128|192|256)(?:GCM)?(?:KW)?$/.test(e)||/^A(?:128|192|256)CBC-HS(?:256|384|512)$/.test(e)?Da(e,t,n):Ma(e,t,n)},Ka=(e,t)=>{const n=`SHA-${e.slice(-3)}`;switch(e){case"HS256":case"HS384":case"HS512":return{hash:n,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:n,name:"RSA-PSS",saltLength:parseInt(e.slice(-3),10)>>3};case"RS256":case"RS384":case"RS512":return{hash:n,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:n,name:"ECDSA",namedCurve:t.namedCurve};case"Ed25519":case"EdDSA":return{name:"Ed25519"};default:throw new re(`alg ${e} is not supported either by JOSE or your javascript runtime`)}},Ua=async(e,t,n)=>{if(t instanceof Uint8Array){if(!e.startsWith("HS"))throw new TypeError(Aa(t,"CryptoKey","KeyObject","JSON Web Key"));return crypto.subtle.importKey("raw",t,{hash:`SHA-${e.slice(-3)}`,name:"HMAC"},!1,[n])}return wa(t,e,n),t},Wa=async(e,t,n,r)=>{const a=await Ua(e,t,"verify");_a(e,a);const i=Ka(e,a.algorithm);try{return await crypto.subtle.verify(i,a,n,r)}catch{return!1}};async function Ha(e,t,n){if(!ge(e))throw new L("Flattened JWS must be an object");if(e.protected===void 0&&e.header===void 0)throw new L('Flattened JWS must have either of the "protected" or "header" members');if(e.protected!==void 0&&typeof e.protected!="string")throw new L("JWS Protected Header incorrect type");if(e.payload===void 0)throw new L("JWS Payload missing");if(typeof e.signature!="string")throw new L("JWS Signature missing or incorrect type");if(e.header!==void 0&&!ge(e.header))throw new L("JWS Unprotected Header incorrect type");let r={};if(e.protected)try{const w=Qe(e.protected);r=JSON.parse(je.decode(w))}catch{throw new L("JWS Protected Header is invalid")}if(!Ta(r,e.header))throw new L("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");const a={...r,...e.header},i=Ca(L,new Map([["b64",!0]]),n==null?void 0:n.crit,r,a);let o=!0;if(i.has("b64")&&(o=r.b64,typeof o!="boolean"))throw new L('The "b64" (base64url-encode payload) Header Parameter must be a boolean');const{alg:c}=a;if(typeof c!="string"||!c)throw new L('JWS "alg" (Algorithm) Header Parameter missing or invalid');if(o){if(typeof e.payload!="string")throw new L("JWS Payload must be a string")}else if(typeof e.payload!="string"&&!(e.payload instanceof Uint8Array))throw new L("JWS Payload must be a string or an Uint8Array instance");let l=!1;typeof t=="function"&&(t=await t(r,e),l=!0),ka(c,t,"verify");const f=ga(St.encode(e.protected??""),St.encode("."),typeof e.payload=="string"?St.encode(e.payload):e.payload);let d;try{d=Qe(e.signature)}catch{throw new L("Failed to base64url decode the signature")}const g=await Na(t,c);if(!await Wa(c,g,d,f))throw new hr;let p;if(o)try{p=Qe(e.payload)}catch{throw new L("Failed to base64url decode the payload")}else typeof e.payload=="string"?p=St.encode(e.payload):p=e.payload;const E={payload:p};return e.protected!==void 0&&(E.protectedHeader=r),e.header!==void 0&&(E.unprotectedHeader=e.header),l?{...E,key:g}:E}async function Fa(e,t,n){if(e instanceof Uint8Array&&(e=je.decode(e)),typeof e!="string")throw new L("Compact JWS must be a string or Uint8Array");const{0:r,1:a,2:i,length:o}=e.split(".");if(o!==3)throw new L("Invalid Compact JWS");const c=await Ha({payload:a,protected:r,signature:i},t,n),l={payload:c.payload,protectedHeader:c.protectedHeader};return typeof t=="function"?{...l,key:c.key}:l}const $a=e=>Math.floor(e.getTime()/1e3),br=60,wr=br*60,rn=wr*24,Ja=rn*7,Ga=rn*365.25,za=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i,Bn=e=>{const t=za.exec(e);if(!t||t[4]&&t[1])throw new TypeError("Invalid time period format");const n=parseFloat(t[2]),r=t[3].toLowerCase();let a;switch(r){case"sec":case"secs":case"second":case"seconds":case"s":a=Math.round(n);break;case"minute":case"minutes":case"min":case"mins":case"m":a=Math.round(n*br);break;case"hour":case"hours":case"hr":case"hrs":case"h":a=Math.round(n*wr);break;case"day":case"days":case"d":a=Math.round(n*rn);break;case"week":case"weeks":case"w":a=Math.round(n*Ja);break;default:a=Math.round(n*Ga);break}return t[1]==="-"||t[4]==="ago"?-a:a},qn=e=>e.includes("/")?e.toLowerCase():`application/${e.toLowerCase()}`,Ba=(e,t)=>typeof e=="string"?t.includes(e):Array.isArray(e)?t.some(Set.prototype.has.bind(new Set(e))):!1;function qa(e,t,n={}){let r;try{r=JSON.parse(je.decode(t))}catch{}if(!ge(r))throw new jt("JWT Claims Set must be a top-level JSON object");const{typ:a}=n;if(a&&(typeof e.typ!="string"||qn(e.typ)!==qn(a)))throw new Y('unexpected "typ" JWT header value',r,"typ","check_failed");const{requiredClaims:i=[],issuer:o,subject:c,audience:l,maxTokenAge:f}=n,d=[...i];f!==void 0&&d.push("iat"),l!==void 0&&d.push("aud"),c!==void 0&&d.push("sub"),o!==void 0&&d.push("iss");for(const E of new Set(d.reverse()))if(!(E in r))throw new Y(`missing required "${E}" claim`,r,E,"missing");if(o&&!(Array.isArray(o)?o:[o]).includes(r.iss))throw new Y('unexpected "iss" claim value',r,"iss","check_failed");if(c&&r.sub!==c)throw new Y('unexpected "sub" claim value',r,"sub","check_failed");if(l&&!Ba(r.aud,typeof l=="string"?[l]:l))throw new Y('unexpected "aud" claim value',r,"aud","check_failed");let g;switch(typeof n.clockTolerance){case"string":g=Bn(n.clockTolerance);break;case"number":g=n.clockTolerance;break;case"undefined":g=0;break;default:throw new TypeError("Invalid clockTolerance option type")}const{currentDate:S}=n,p=$a(S||new Date);if((r.iat!==void 0||f)&&typeof r.iat!="number")throw new Y('"iat" claim must be a number',r,"iat","invalid");if(r.nbf!==void 0){if(typeof r.nbf!="number")throw new Y('"nbf" claim must be a number',r,"nbf","invalid");if(r.nbf>p+g)throw new Y('"nbf" claim timestamp check failed',r,"nbf","check_failed")}if(r.exp!==void 0){if(typeof r.exp!="number")throw new Y('"exp" claim must be a number',r,"exp","invalid");if(r.exp<=p-g)throw new Vt('"exp" claim timestamp check failed',r,"exp","check_failed")}if(f){const E=p-r.iat,w=typeof f=="number"?f:Bn(f);if(E-g>w)throw new Vt('"iat" claim timestamp check failed (too far in the past)',r,"iat","check_failed");if(E<0-g)throw new Y('"iat" claim timestamp check failed (it should be in the past)',r,"iat","check_failed")}return r}async function Va(e,t,n){var o;const r=await Fa(e,t,n);if((o=r.protectedHeader.crit)!=null&&o.includes("b64")&&r.protectedHeader.b64===!1)throw new jt("JWTs MUST NOT use unencoded payload");const i={payload:qa(r.protectedHeader,r.payload,n),protectedHeader:r.protectedHeader};return typeof t=="function"?{...i,key:r.key}:i}function Ya(e){switch(typeof e=="string"&&e.slice(0,2)){case"RS":case"PS":return"RSA";case"ES":return"EC";case"Ed":return"OKP";default:throw new re('Unsupported "alg" value for a JSON Web Key Set')}}function Xa(e){return e&&typeof e=="object"&&Array.isArray(e.keys)&&e.keys.every(Za)}function Za(e){return ge(e)}var ke,et;class Qa{constructor(t){B(this,ke);B(this,et,new WeakMap);if(!Xa(t))throw new en("JSON Web Key Set malformed");D(this,ke,structuredClone(t))}jwks(){return A(this,ke)}async getKey(t,n){const{alg:r,kid:a}={...t,...n==null?void 0:n.header},i=Ya(r),o=A(this,ke).keys.filter(f=>{let d=i===f.kty;if(d&&typeof a=="string"&&(d=a===f.kid),d&&typeof f.alg=="string"&&(d=r===f.alg),d&&typeof f.use=="string"&&(d=f.use==="sig"),d&&Array.isArray(f.key_ops)&&(d=f.key_ops.includes("verify")),d)switch(r){case"ES256":d=f.crv==="P-256";break;case"ES384":d=f.crv==="P-384";break;case"ES512":d=f.crv==="P-521";break;case"Ed25519":case"EdDSA":d=f.crv==="Ed25519";break}return d}),{0:c,length:l}=o;if(l===0)throw new tn;if(l!==1){const f=new fr,d=A(this,et);throw f[Symbol.asyncIterator]=async function*(){for(const g of o)try{yield await Vn(d,g,r)}catch{}},f}return Vn(A(this,et),c,r)}}ke=new WeakMap,et=new WeakMap;async function Vn(e,t,n){const r=e.get(t)||e.set(t,{}).get(t);if(r[n]===void 0){const a=await xa({...t,ext:!0},n);if(a instanceof Uint8Array||a.type!=="public")throw new en("JSON Web Key Set members must be public keys");r[n]=a}return r[n]}function Yn(e){const t=new Qa(e),n=async(r,a)=>t.getKey(r,a);return Object.defineProperties(n,{jwks:{value:()=>structuredClone(t.jwks()),enumerable:!1,configurable:!1,writable:!1}}),n}function ja(){return typeof WebSocketPair<"u"||typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"||typeof EdgeRuntime<"u"&&EdgeRuntime==="vercel"}let Xt;var Et,tr;(typeof navigator>"u"||!((tr=(Et=navigator.userAgent)==null?void 0:Et.startsWith)!=null&&tr.call(Et,"Mozilla/5.0 ")))&&(Xt="jose/v6.0.12");const es=Symbol();async function ts(e,t,n,r=fetch){const a=await r(e,{method:"GET",signal:n,redirect:"manual",headers:t}).catch(i=>{throw i.name==="TimeoutError"?new dr:i});if(a.status!==200)throw new q("Expected 200 OK from the JSON Web Key Set HTTP response");try{return await a.json()}catch{throw new q("Failed to parse the JSON Web Key Set HTTP response as JSON")}}const zt=Symbol();function ns(e,t){return!(typeof e!="object"||e===null||!("uat"in e)||typeof e.uat!="number"||Date.now()-e.uat>=t||!("jwks"in e)||!ge(e.jwks)||!Array.isArray(e.jwks.keys)||!Array.prototype.every.call(e.jwks.keys,ge))}var tt,nt,rt,Ke,fe,ee,te,at,de,he;class rs{constructor(t,n){B(this,tt);B(this,nt);B(this,rt);B(this,Ke);B(this,fe);B(this,ee);B(this,te);B(this,at);B(this,de);B(this,he);if(!(t instanceof URL))throw new TypeError("url must be an instance of URL");D(this,tt,new URL(t.href)),D(this,nt,typeof(n==null?void 0:n.timeoutDuration)=="number"?n==null?void 0:n.timeoutDuration:5e3),D(this,rt,typeof(n==null?void 0:n.cooldownDuration)=="number"?n==null?void 0:n.cooldownDuration:3e4),D(this,Ke,typeof(n==null?void 0:n.cacheMaxAge)=="number"?n==null?void 0:n.cacheMaxAge:6e5),D(this,te,new Headers(n==null?void 0:n.headers)),Xt&&!A(this,te).has("User-Agent")&&A(this,te).set("User-Agent",Xt),A(this,te).has("accept")||(A(this,te).set("accept","application/json"),A(this,te).append("accept","application/jwk-set+json")),D(this,at,n==null?void 0:n[es]),(n==null?void 0:n[zt])!==void 0&&(D(this,he,n==null?void 0:n[zt]),ns(n==null?void 0:n[zt],A(this,Ke))&&(D(this,fe,A(this,he).uat),D(this,de,Yn(A(this,he).jwks))))}pendingFetch(){return!!A(this,ee)}coolingDown(){return typeof A(this,fe)=="number"?Date.now()<A(this,fe)+A(this,rt):!1}fresh(){return typeof A(this,fe)=="number"?Date.now()<A(this,fe)+A(this,Ke):!1}jwks(){var t;return(t=A(this,de))==null?void 0:t.jwks()}async getKey(t,n){(!A(this,de)||!this.fresh())&&await this.reload();try{return await A(this,de).call(this,t,n)}catch(r){if(r instanceof tn&&this.coolingDown()===!1)return await this.reload(),A(this,de).call(this,t,n);throw r}}async reload(){A(this,ee)&&ja()&&D(this,ee,void 0),A(this,ee)||D(this,ee,ts(A(this,tt).href,A(this,te),AbortSignal.timeout(A(this,nt)),A(this,at)).then(t=>{D(this,de,Yn(t)),A(this,he)&&(A(this,he).uat=Date.now(),A(this,he).jwks=t),D(this,fe,Date.now()),D(this,ee,void 0)}).catch(t=>{throw D(this,ee,void 0),t})),await A(this,ee)}}tt=new WeakMap,nt=new WeakMap,rt=new WeakMap,Ke=new WeakMap,fe=new WeakMap,ee=new WeakMap,te=new WeakMap,at=new WeakMap,de=new WeakMap,he=new WeakMap;function as(e,t){const n=new rs(e,t),r=async(a,i)=>n.getKey(a,i);return Object.defineProperties(r,{coolingDown:{get:()=>n.coolingDown(),enumerable:!0,configurable:!1},fresh:{get:()=>n.fresh(),enumerable:!0,configurable:!1},reload:{value:()=>n.reload(),enumerable:!0,configurable:!1,writable:!1},reloading:{get:()=>n.pendingFetch(),enumerable:!0,configurable:!1},jwks:{value:()=>n.jwks(),enumerable:!0,configurable:!1,writable:!1}}),r}const $="http://localhost:3000";let Ae=localStorage.getItem("authToken"),Ar,Zt;const m={};function ye(e){const t=m.connectionStatusDot,n=m.connectionStatusText;if(!(!t||!n))switch(t.classList.remove("bg-green-500","bg-red-500","bg-yellow-500"),e){case"connected":t.classList.add("bg-green-500"),n.textContent="Connected";break;case"error":t.classList.add("bg-red-500"),n.textContent="Error";break;case"connecting":t.classList.add("bg-yellow-500"),n.textContent="Connecting...";break;default:t.classList.add("bg-yellow-500"),n.textContent="Status";break}}function pe(e){return btoa(String.fromCharCode.apply(null,new Uint8Array(e))).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}async function Se(e,t={}){if(!Zt)throw new Error("Cannot make requests: JWKS verifier is not available.");const n={"Content-Type":"application/json",...t.headers};Ae&&(n.Authorization=`Bearer ${Ae}`),t.method&&t.method!=="GET"&&(n["X-CSRF-Token"]=Ar);const r=await fetch(e,{...t,headers:n,credentials:"include"}),a=localStorage.getItem("serverSessionToken"),i=r.headers.get("X-Server-Session-Token");if(i&&a&&i!==a){console.warn("New server session token detected. Verifying signature...");try{throw await Va(i,Zt),console.log("New token is valid. Server has restarted or rotated keys. Refreshing."),localStorage.setItem("serverSessionToken",i),localStorage.removeItem("authToken"),window.location.reload(),new Error("Server restarted.")}catch(o){throw console.error("CRITICAL SECURITY ALERT: Invalid server session token signature! Halting.",o),G("Security Alert: Server identity mismatch. Disconnecting."),new Error("Invalid server token signature.")}}if(r.status===401)throw st(),G("Session expired. Please log in again."),new Error("Authentication failed");if(!r.ok){const o=await r.json().catch(()=>({error:"An unknown server error occurred."}));throw new Error(o.error||`HTTP error! Status: ${r.status}`)}if(r.status!==204)return r.json()}function an(e,t){Ae=e,localStorage.setItem("authToken",e),m.authStatus.textContent=`Welcome, ${t}!`,m.loginBtn.textContent="Log Out",m.registerBtn.style.display="block",m.loginBtn.removeEventListener("click",sn),m.loginBtn.addEventListener("click",st),Tr(),At()}function st(){Ae=null,localStorage.removeItem("authToken"),m.authStatus.textContent="",m.loginBtn.textContent="Login",m.registerBtn.style.display="none",m.loginBtn.removeEventListener("click",st),m.loginBtn.addEventListener("click",sn),m.ordersList.innerHTML="",m.noOrdersMessage.textContent="Please log in to view orders.",m.noOrdersMessage.style.display="block"}async function ss(){const e=m.usernameInput.value;if(!e){G("Please enter your username.");return}Ue();try{const t=await Se(`${$}/api/auth/login-options?username=${encodeURIComponent(e)}`);if(t.allowCredentials&&t.allowCredentials.length===0){Ee(),G("No security key registered for this user. Please register a key first.");return}const n=await zr(t),r={username:e,id:n.id,rawId:pe(n.rawId),type:n.type,response:{clientDataJSON:pe(n.response.clientDataJSON),authenticatorData:pe(n.response.authenticatorData),signature:pe(n.response.signature),userHandle:n.response.userHandle?pe(n.response.userHandle):null}},a=await Se(`${$}/api/auth/login-verify`,{method:"POST",body:JSON.stringify(r)});if(a.verified)an(a.token,e),it("Successfully logged in with Security Key!");else throw new Error(a.error||"WebAuthn verification failed.")}catch(t){G(`WebAuthn Login Failed: ${t.message}`),console.error(t)}finally{Ee()}}async function is(){const e=m.usernameInput.value,t=m.passwordInput.value;if(!e||!t){G("Username and password are required.");return}Ue();try{const n=await Se(`${$}/api/auth/login`,{method:"POST",body:JSON.stringify({username:e,password:t})});if(n.token)an(n.token,e),it("Login successful!");else throw new Error("Password verification failed.")}catch(n){G(`Password Login Failed: ${n.message}`),console.error(n)}finally{Ee()}}async function Xn(){const e=m.usernameInput.value;if(!e){G("Please enter a username to register a key.");return}Ue();try{const t=await Se(`${$}/api/auth/pre-register`,{method:"POST",body:JSON.stringify({username:e})}),n=await $r(t),r={username:e,id:n.id,rawId:pe(n.rawId),type:n.type,response:{clientDataJSON:pe(n.response.clientDataJSON),attestationObject:pe(n.response.attestationObject)}},a=await Se(`${$}/api/auth/register-verify`,{method:"POST",body:JSON.stringify(r)});if(a.verified)it("Security Key registered successfully!");else throw new Error(a.error||"Registration failed.")}catch(t){G(`Registration Failed: ${t.message}`),console.error(t)}finally{Ee()}}function sn(){var e;(e=m.loginModal)==null||e.classList.remove("hidden")}function Tr(){var e;(e=m.loginModal)==null||e.classList.add("hidden")}function Ue(){var e;(e=m.loadingIndicator)==null||e.classList.remove("hidden")}function Ee(){var e;(e=m.loadingIndicator)==null||e.classList.add("hidden")}function G(e){m.errorMessage.textContent=e,m.errorToast.classList.remove("hidden"),setTimeout(Rr,5e3)}function Rr(){var e;(e=m.errorToast)==null||e.classList.add("hidden")}function it(e){m.successMessage.textContent=e,m.successToast.classList.remove("hidden"),setTimeout(_r,3e3)}function _r(){var e;(e=m.successToast)==null||e.classList.add("hidden")}async function At(e=""){if(!Ae){m.noOrdersMessage.textContent="Please log in to view orders.",ye("idle");return}Ue(),ye("connecting"),m.noOrdersMessage.textContent="Loading orders...",m.noOrdersMessage.style.display="block",m.ordersList.innerHTML="";try{const t=e?`${$}/api/orders/search?q=${encodeURIComponent(e)}`:`${$}/api/orders`,n=await Se(t);n.length===0?m.noOrdersMessage.textContent="No orders found.":(m.noOrdersMessage.style.display="none",n.forEach(os)),ye("connected")}catch(t){console.error("[SHOP] Error fetching orders:",t),ye("error"),t.message!=="Authentication failed"&&G(`Could not fetch orders: ${t.message}`)}finally{Ee()}}function os(e){var a,i,o,c;const t=document.createElement("div");t.className="order-card",t.id=`order-card-${e.orderId}`;const n=e.amount?`$${(e.amount/100).toFixed(2)}`:"N/A",r=new Date(e.receivedAt).toLocaleString();t.innerHTML=ha.sanitize(`
        <div class="flex justify-between items-start">
            <div>
                <h3 class="text-xl text-splotch-red">Order ID: <span class="font-mono text-sm">${e.orderId.substring(0,8)}...</span></h3>
                <p class="text-sm text-gray-600">Received: ${r}</p>
            </div>
            <div id="status-badge-${e.orderId}" class="status-${e.status.toLowerCase()} font-bold py-1 px-3 rounded-full text-sm">${e.status}</div>
        </div>
        <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4 order-details">
            <div>
                <dt>Name:</dt> <dd>${((a=e.billingContact)==null?void 0:a.givenName)||""} ${((i=e.billingContact)==null?void 0:i.familyName)||""}</dd>
                <dt>Email:</dt> <dd>${((o=e.billingContact)==null?void 0:o.email)||"N/A"}</dd>
            </div>
            <div>
                <dt>Quantity:</dt> <dd>${((c=e.orderDetails)==null?void 0:c.quantity)||"N/A"}</dd>
                <dt>Amount:</dt> <dd>${n}</dd>
            </div>
        </div>
        <div class="mt-4">
            <dt>Sticker Design:</dt>
            <a href="${$}${e.designImagePath}" target="_blank"><img src="${$}${e.designImagePath}" alt="Sticker Design" class="sticker-design" data-cut-file-path="${e.cutLinePath||""}"></a>
        </div>
        <div class="mt-4 flex flex-wrap gap-2">
            <button class="action-btn" data-order-id="${e.orderId}" data-status="ACCEPTED">Accept</button>
            <button class="action-btn" data-order-id="${e.orderId}" data-status="PRINTING">Print</button>
            <button class="action-btn" data-order-id="${e.orderId}" data-status="SHIPPED">Ship</button>
            <button class="action-btn" data-order-id="${e.orderId}" data-status="CANCELED">Cancel</button>
        </div>`),m.ordersList.prepend(t),t.querySelectorAll(".action-btn").forEach(l=>{l.addEventListener("click",f=>{const d=f.target.dataset.orderId,g=f.target.dataset.status;cs(d,g)})})}async function cs(e,t){Ue();try{await Se(`${$}/api/orders/${e}/status`,{method:"POST",body:JSON.stringify({status:t})}),it(`Order status updated to ${t}.`);const n=document.getElementById(`status-badge-${e}`);n&&(n.className=`status-${t.toLowerCase()} font-bold py-1 px-3 rounded-full text-sm`,n.textContent=t)}catch(n){G(`Update Failed: ${n.message}`),console.error(n)}finally{Ee()}}async function Zn(){const e=m.searchInput.value.trim();if(!e){At();return}At(e)}async function ls(){if(Ue(),m.nestedSvgContainer.innerHTML="<p>Nesting in progress...</p>",Array.from(m.ordersList.querySelectorAll(".sticker-design")).map(t=>t.src).length===0){m.nestedSvgContainer.innerHTML="<p>No designs to nest.</p>",Ee();return}try{const t=Array.from(m.ordersList.querySelectorAll(".sticker-design")).map(async(p,E)=>{const w=p.dataset.cutFilePath;if(w)return(await fetch(`${$}${w}`,{credentials:"include"})).text();{const Z=await(await fetch(p.src,{credentials:"include"})).text();return vr(Z)}}),n=await Promise.all(t),r=12*96,a=12*96,i=`<svg width="${r}" height="${a}"><rect x="0" y="0" width="${r}" height="${a}" fill="none" stroke="blue" stroke-width="2"/></svg>`,o=new ya,c=n.map(p=>o.load(p)),l=o.load(i),d={spacing:parseInt(m.spacingInput.value,10)||0,rotations:4},S=new SVGNest(l,c,d).start();m.nestedSvgContainer.innerHTML=S,window.nestedSvg=S,it("Nesting complete.")}catch(t){G(`Nesting failed: ${t.message}`)}finally{Ee()}}function vr(e){const r=new DOMParser().parseFromString(e,"image/svg+xml").documentElement,a=document.createElementNS("http://www.w3.org/2000/svg","svg");return a.setAttribute("width",r.getAttribute("width")),a.setAttribute("height",r.getAttribute("height")),a.setAttribute("viewBox",r.getAttribute("viewBox")),r.querySelectorAll("path").forEach(i=>{const o=i.cloneNode();o.setAttribute("stroke","red"),o.setAttribute("fill","none"),a.appendChild(o)}),new XMLSerializer().serializeToString(a)}function us(){if(!window.nestedSvg){G("No nested SVG to generate a cut file from.");return}const e=vr(window.nestedSvg),t=new Blob([e],{type:"image/svg+xml"}),n=URL.createObjectURL(t),r=document.createElement("a");r.href=n,r.download="cut-file.svg",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(n)}async function fs(){try{const e=await fetch(`${$}/api/server-info`,{credentials:"include"}),{serverSessionToken:t}=await e.json();localStorage.setItem("serverSessionToken",t),console.log("[CLIENT] Initial server session token acquired.")}catch(e){console.error("Could not acquire server session token.",e)}}async function Qn(){if(!Ae)return ye("idle"),!1;ye("connecting");try{const e=await Se(`${$}/api/auth/verify-token`);return e.username?(an(Ae,e.username),!0):(ye("error"),!1)}catch(e){return ye("error"),console.error("Token verification failed:",e),st(),!1}}async function ds(){try{Ar=(await(await fetch(`${$}/api/csrf-token`,{credentials:"include"})).json()).csrfToken}catch(e){console.error("Fatal: Could not fetch CSRF token. App may not function correctly.",e),G("Could not establish a secure session with the server.")}}async function hs(){var r,a,i,o,c,l,f,d,g,S,p,E,w;Zt=as(new URL(`${$}/.well-known/jwks.json`)),console.log("[CLIENT] Remote JWKS verifier created."),await fs(),["orders-list","no-orders-message","refreshOrdersBtn","nestStickersBtn","nested-svg-container","spacingInput","registerBtn","loginBtn","auth-status","loading-indicator","error-toast","error-message","close-error-toast","success-toast","success-message","close-success-toast","searchInput","searchBtn","downloadCutFileBtn","login-modal","close-modal-btn","username-input","password-input","password-login-btn","webauthn-login-btn","webauthn-register-btn","connection-status-dot","connection-status-text"].forEach(k=>{const Z=k.replace(/-(\w)/g,(Te,z)=>z.toUpperCase());m[Z]=document.getElementById(k)}),await ds(),(r=m.refreshOrdersBtn)==null||r.addEventListener("click",()=>At()),(a=m.registerBtn)==null||a.addEventListener("click",Xn),(i=m.closeErrorToast)==null||i.addEventListener("click",Rr),(o=m.closeSuccessToast)==null||o.addEventListener("click",_r),(c=m.nestStickersBtn)==null||c.addEventListener("click",ls),(l=m.downloadCutFileBtn)==null||l.addEventListener("click",us),(f=m.searchBtn)==null||f.addEventListener("click",Zn),(d=m.searchInput)==null||d.addEventListener("keyup",k=>{k.key==="Enter"&&Zn()}),(g=m.closeModalBtn)==null||g.addEventListener("click",Tr),(S=m.passwordLoginBtn)==null||S.addEventListener("click",is),(p=m.webauthnLoginBtn)==null||p.addEventListener("click",ss),(E=m.webauthnRegisterBtn)==null||E.addEventListener("click",Xn),(w=m.loginBtn)==null||w.addEventListener("click",sn);const n=new URLSearchParams(window.location.search).get("token");n?(localStorage.setItem("authToken",n),await Qn(),window.history.replaceState({},document.title,"/printshop.html")):await Qn()||st()}document.addEventListener("DOMContentLoaded",hs);
