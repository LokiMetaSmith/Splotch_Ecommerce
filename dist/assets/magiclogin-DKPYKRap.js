import"./modulepreload-polyfill-B5Qt9EMX.js";const i="http://localhost:3000";let a;const n=document.getElementById("login-status"),c=document.getElementById("order-history"),s=document.getElementById("orders-list");async function d(){try{const r=await fetch(`${i}/api/csrf-token`,{credentials:"include"});if(!r.ok)throw new Error(`Server responded with ${r.status}`);const e=await r.json();if(!e.csrfToken)throw new Error("CSRF token not found in server response");a=e.csrfToken}catch(r){console.error("Error fetching CSRF token:",r),n.innerHTML="<p>A security token could not be loaded. Please refresh the page.</p>"}}window.addEventListener("load",async()=>{await d();const e=new URLSearchParams(window.location.search).get("token");if(!e){n.innerHTML="<p>No login token found.</p>";return}try{const o=await(await fetch(`${i}/api/auth/verify-magic-link`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json","X-CSRF-Token":a},body:JSON.stringify({token:e})})).json();o.success?(n.classList.add("hidden"),c.classList.remove("hidden"),l(o.token)):n.innerHTML=`<p>Error logging in: ${o.error}</p>`}catch(t){console.error("Error verifying magic link:",t),n.innerHTML=`<p>Error logging in: ${t.message}</p>`}});async function l(r){try{const e=await fetch(`${i}/api/orders`,{credentials:"include",headers:{Authorization:`Bearer ${r}`}});if(!e.ok)throw new Error(`Server responded with status: ${e.status}`);const t=await e.json();p(t)}catch(e){console.error("Error fetching order history:",e),s.innerHTML=`<p>Error fetching order history: ${e.message}</p>`}}function p(r){if(r.length===0){s.innerHTML="<p>You have no past orders.</p>";return}r.forEach(e=>{const t=document.createElement("div");t.classList.add("p-4","bg-white","rounded-lg","shadow-md"),t.innerHTML=`
            <h3 class="text-xl font-semibold">${e.orderDetails.material} Stickers</h3>
            <p>Quantity: ${e.orderDetails.quantity}</p>
            <p>Order ID: ${e.orderId}</p>
            <p>Status: ${e.status}</p>
        `,s.appendChild(t)})}
