var Mr=Object.defineProperty;var Pn=e=>{throw TypeError(e)};var kr=(e,t,n)=>t in e?Mr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var T=(e,t,n)=>kr(e,typeof t!="symbol"?t+"":t,n),Ln=(e,t,n)=>t.has(e)||Pn("Cannot "+n);var A=(e,t,n)=>(Ln(e,t,"read from private field"),n?n.call(e):t.get(e)),B=(e,t,n)=>t.has(e)?Pn("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),D=(e,t,n,r)=>(Ln(e,t,"write to private field"),r?r.call(e,n):t.set(e,n),n);import"./modulepreload-polyfill-B5Qt9EMX.js";/* empty css               */function te(e){const t=new Uint8Array(e);let n="";for(const a of t)n+=String.fromCharCode(a);return btoa(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function wt(e){const t=e.replace(/-/g,"+").replace(/_/g,"/"),n=(4-t.length%4)%4,r=t.padEnd(t.length+n,"="),a=atob(r),i=new ArrayBuffer(a.length),o=new Uint8Array(i);for(let c=0;c<a.length;c++)o[c]=a.charCodeAt(c);return i}function Qt(){return Kr.stubThis((globalThis==null?void 0:globalThis.PublicKeyCredential)!==void 0&&typeof globalThis.PublicKeyCredential=="function")}const Kr={stubThis:e=>e};function nr(e){const{id:t}=e;return{...e,id:wt(t),transports:e.transports}}function rr(e){return e==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(e)}class M extends Error{constructor({message:t,code:n,cause:r,name:a}){super(t,{cause:r}),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=a??r.name,this.code=n}}function Ur({error:e,options:t}){var r,a,i;const{publicKey:n}=t;if(!n)throw Error("options was missing required publicKey property");if(e.name==="AbortError"){if(t.signal instanceof AbortSignal)return new M({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else if(e.name==="ConstraintError"){if(((r=n.authenticatorSelection)==null?void 0:r.requireResidentKey)===!0)return new M({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:e});if(t.mediation==="conditional"&&((a=n.authenticatorSelection)==null?void 0:a.userVerification)==="required")return new M({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:e});if(((i=n.authenticatorSelection)==null?void 0:i.userVerification)==="required")return new M({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:e})}else{if(e.name==="InvalidStateError")return new M({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:e});if(e.name==="NotAllowedError")return new M({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if(e.name==="NotSupportedError")return n.pubKeyCredParams.filter(c=>c.type==="public-key").length===0?new M({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:e}):new M({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:e});if(e.name==="SecurityError"){const o=globalThis.location.hostname;if(rr(o)){if(n.rp.id!==o)return new M({message:`The RP ID "${n.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else return new M({message:`${globalThis.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e})}else if(e.name==="TypeError"){if(n.user.id.byteLength<1||n.user.id.byteLength>64)return new M({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:e})}else if(e.name==="UnknownError")return new M({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return e}class Wr{constructor(){Object.defineProperty(this,"controller",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}createNewAbortSignal(){if(this.controller){const n=new Error("Cancelling existing WebAuthn API call for new one");n.name="AbortError",this.controller.abort(n)}const t=new AbortController;return this.controller=t,t.signal}cancelCeremony(){if(this.controller){const t=new Error("Manually cancelling existing WebAuthn API call");t.name="AbortError",this.controller.abort(t),this.controller=void 0}}}const ar=new Wr,Hr=["cross-platform","platform"];function sr(e){if(e&&!(Hr.indexOf(e)<0))return e}async function $r(e){var E;!e.optionsJSON&&e.challenge&&(console.warn("startRegistration() was not called correctly. It will try to continue with the provided options, but this call should be refactored to use the expected call structure instead. See https://simplewebauthn.dev/docs/packages/browser#typeerror-cannot-read-properties-of-undefined-reading-challenge for more information."),e={optionsJSON:e});const{optionsJSON:t,useAutoRegister:n=!1}=e;if(!Qt())throw new Error("WebAuthn is not supported in this browser");const r={...t,challenge:wt(t.challenge),user:{...t.user,id:wt(t.user.id)},excludeCredentials:(E=t.excludeCredentials)==null?void 0:E.map(nr)},a={};n&&(a.mediation="conditional"),a.publicKey=r,a.signal=ar.createNewAbortSignal();let i;try{i=await navigator.credentials.create(a)}catch(w){throw Ur({error:w,options:a})}if(!i)throw new Error("Registration was not completed");const{id:o,rawId:c,response:l,type:u}=i;let d;typeof l.getTransports=="function"&&(d=l.getTransports());let p;if(typeof l.getPublicKeyAlgorithm=="function")try{p=l.getPublicKeyAlgorithm()}catch(w){kt("getPublicKeyAlgorithm()",w)}let S;if(typeof l.getPublicKey=="function")try{const w=l.getPublicKey();w!==null&&(S=te(w))}catch(w){kt("getPublicKey()",w)}let g;if(typeof l.getAuthenticatorData=="function")try{g=te(l.getAuthenticatorData())}catch(w){kt("getAuthenticatorData()",w)}return{id:o,rawId:te(c),response:{attestationObject:te(l.attestationObject),clientDataJSON:te(l.clientDataJSON),transports:d,publicKeyAlgorithm:p,publicKey:S,authenticatorData:g},type:u,clientExtensionResults:i.getClientExtensionResults(),authenticatorAttachment:sr(i.authenticatorAttachment)}}function kt(e,t){console.warn(`The browser extension that intercepted this WebAuthn API call incorrectly implemented ${e}. You should report this error to them.
`,t)}function Fr(){if(!Qt())return Kt.stubThis(new Promise(t=>t(!1)));const e=globalThis.PublicKeyCredential;return(e==null?void 0:e.isConditionalMediationAvailable)===void 0?Kt.stubThis(new Promise(t=>t(!1))):Kt.stubThis(e.isConditionalMediationAvailable())}const Kt={stubThis:e=>e};function Jr({error:e,options:t}){const{publicKey:n}=t;if(!n)throw Error("options was missing required publicKey property");if(e.name==="AbortError"){if(t.signal instanceof AbortSignal)return new M({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else{if(e.name==="NotAllowedError")return new M({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if(e.name==="SecurityError"){const r=globalThis.location.hostname;if(rr(r)){if(n.rpId!==r)return new M({message:`The RP ID "${n.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else return new M({message:`${globalThis.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e})}else if(e.name==="UnknownError")return new M({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return e}async function Gr(e){var g,E;!e.optionsJSON&&e.challenge&&(console.warn("startAuthentication() was not called correctly. It will try to continue with the provided options, but this call should be refactored to use the expected call structure instead. See https://simplewebauthn.dev/docs/packages/browser#typeerror-cannot-read-properties-of-undefined-reading-challenge for more information."),e={optionsJSON:e});const{optionsJSON:t,useBrowserAutofill:n=!1,verifyBrowserAutofillInput:r=!0}=e;if(!Qt())throw new Error("WebAuthn is not supported in this browser");let a;((g=t.allowCredentials)==null?void 0:g.length)!==0&&(a=(E=t.allowCredentials)==null?void 0:E.map(nr));const i={...t,challenge:wt(t.challenge),allowCredentials:a},o={};if(n){if(!await Fr())throw Error("Browser does not support WebAuthn autofill");if(document.querySelectorAll("input[autocomplete$='webauthn']").length<1&&r)throw Error('No <input> with "webauthn" as the only or last value in its `autocomplete` attribute was detected');o.mediation="conditional",i.allowCredentials=[]}o.publicKey=i,o.signal=ar.createNewAbortSignal();let c;try{c=await navigator.credentials.get(o)}catch(w){throw Jr({error:w,options:o})}if(!c)throw new Error("Authentication was not completed");const{id:l,rawId:u,response:d,type:p}=c;let S;return d.userHandle&&(S=te(d.userHandle)),{id:l,rawId:te(u),response:{authenticatorData:te(d.authenticatorData),clientDataJSON:te(d.clientDataJSON),signature:te(d.signature),userHandle:S},type:p,clientExtensionResults:c.getClientExtensionResults(),authenticatorAttachment:sr(c.authenticatorAttachment)}}/*! @license DOMPurify 3.2.6 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.2.6/LICENSE */const{entries:ir,setPrototypeOf:Nn,isFrozen:zr,getPrototypeOf:Br,getOwnPropertyDescriptor:Vr}=Object;let{freeze:W,seal:q,create:or}=Object,{apply:Bt,construct:Vt}=typeof Reflect<"u"&&Reflect;W||(W=function(t){return t});q||(q=function(t){return t});Bt||(Bt=function(t,n,r){return t.apply(n,r)});Vt||(Vt=function(t,n){return new t(...n)});const pt=H(Array.prototype.forEach),qr=H(Array.prototype.lastIndexOf),Dn=H(Array.prototype.pop),Be=H(Array.prototype.push),Yr=H(Array.prototype.splice),bt=H(String.prototype.toLowerCase),Ut=H(String.prototype.toString),Mn=H(String.prototype.match),Ve=H(String.prototype.replace),Xr=H(String.prototype.indexOf),Zr=H(String.prototype.trim),X=H(Object.prototype.hasOwnProperty),U=H(RegExp.prototype.test),qe=Qr(TypeError);function H(e){return function(t){t instanceof RegExp&&(t.lastIndex=0);for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return Bt(e,t,r)}}function Qr(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Vt(e,n)}}function b(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:bt;Nn&&Nn(e,null);let r=t.length;for(;r--;){let a=t[r];if(typeof a=="string"){const i=n(a);i!==a&&(zr(t)||(t[r]=i),a=i)}e[a]=!0}return e}function jr(e){for(let t=0;t<e.length;t++)X(e,t)||(e[t]=null);return e}function le(e){const t=or(null);for(const[n,r]of ir(e))X(e,n)&&(Array.isArray(r)?t[n]=jr(r):r&&typeof r=="object"&&r.constructor===Object?t[n]=le(r):t[n]=r);return t}function Ye(e,t){for(;e!==null;){const r=Vr(e,t);if(r){if(r.get)return H(r.get);if(typeof r.value=="function")return H(r.value)}e=Br(e)}function n(){return null}return n}const kn=W(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),Wt=W(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),Ht=W(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),ea=W(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),$t=W(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),ta=W(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),Kn=W(["#text"]),Un=W(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),Ft=W(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),Wn=W(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),yt=W(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),na=q(/\{\{[\w\W]*|[\w\W]*\}\}/gm),ra=q(/<%[\w\W]*|[\w\W]*%>/gm),aa=q(/\$\{[\w\W]*/gm),sa=q(/^data-[\-\w.\u00B7-\uFFFF]+$/),ia=q(/^aria-[\-\w]+$/),cr=q(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),oa=q(/^(?:\w+script|data):/i),ca=q(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),lr=q(/^html$/i),la=q(/^[a-z][.\w]*(-[.\w]+)+$/i);var Hn=Object.freeze({__proto__:null,ARIA_ATTR:ia,ATTR_WHITESPACE:ca,CUSTOM_ELEMENT:la,DATA_ATTR:sa,DOCTYPE_NAME:lr,ERB_EXPR:ra,IS_ALLOWED_URI:cr,IS_SCRIPT_OR_DATA:oa,MUSTACHE_EXPR:na,TMPLIT_EXPR:aa});const Xe={element:1,text:3,progressingInstruction:7,comment:8,document:9},ua=function(){return typeof window>"u"?null:window},fa=function(t,n){if(typeof t!="object"||typeof t.createPolicy!="function")return null;let r=null;const a="data-tt-policy-suffix";n&&n.hasAttribute(a)&&(r=n.getAttribute(a));const i="dompurify"+(r?"#"+r:"");try{return t.createPolicy(i,{createHTML(o){return o},createScriptURL(o){return o}})}catch{return console.warn("TrustedTypes policy "+i+" could not be created."),null}},$n=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function ur(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:ua();const t=y=>ur(y);if(t.version="3.2.6",t.removed=[],!e||!e.document||e.document.nodeType!==Xe.document||!e.Element)return t.isSupported=!1,t;let{document:n}=e;const r=n,a=r.currentScript,{DocumentFragment:i,HTMLTemplateElement:o,Node:c,Element:l,NodeFilter:u,NamedNodeMap:d=e.NamedNodeMap||e.MozNamedAttrMap,HTMLFormElement:p,DOMParser:S,trustedTypes:g}=e,E=l.prototype,w=Ye(E,"cloneNode"),$=Ye(E,"remove"),he=Ye(E,"nextSibling"),Te=Ye(E,"childNodes"),z=Ye(E,"parentNode");if(typeof o=="function"){const y=n.createElement("template");y.content&&y.content.ownerDocument&&(n=y.content.ownerDocument)}let I,Z="";const{implementation:me,createNodeIterator:Tt,createDocumentFragment:re,getElementsByTagName:ae}=n,{importNode:Re}=r;let v=$n();t.isSupported=typeof ir=="function"&&typeof z=="function"&&me&&me.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:We,ERB_EXPR:_e,TMPLIT_EXPR:He,DATA_ATTR:ot,ARIA_ATTR:Rt,IS_SCRIPT_OR_DATA:be,ATTR_WHITESPACE:$e,CUSTOM_ELEMENT:vr}=Hn;let{IS_ALLOWED_URI:on}=Hn,O=null;const cn=b({},[...kn,...Wt,...Ht,...$t,...Kn]);let N=null;const ln=b({},[...Un,...Ft,...Wn,...yt]);let _=Object.seal(or(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),Fe=null,_t=null,un=!0,vt=!0,fn=!1,dn=!0,ve=!1,ct=!0,we=!1,xt=!1,Ct=!1,xe=!1,lt=!1,ut=!1,hn=!0,mn=!1;const xr="user-content-";let It=!0,Je=!1,Ce={},Ie=null;const pn=b({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let yn=null;const gn=b({},["audio","video","img","source","image","track"]);let Ot=null;const Sn=b({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),ft="http://www.w3.org/1998/Math/MathML",dt="http://www.w3.org/2000/svg",se="http://www.w3.org/1999/xhtml";let Oe=se,Pt=!1,Lt=null;const Cr=b({},[ft,dt,se],Ut);let ht=b({},["mi","mo","mn","ms","mtext"]),mt=b({},["annotation-xml"]);const Ir=b({},["title","style","font","a","script"]);let Ge=null;const Or=["application/xhtml+xml","text/html"],Pr="text/html";let P=null,Pe=null;const Lr=n.createElement("form"),En=function(s){return s instanceof RegExp||s instanceof Function},Nt=function(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(Pe&&Pe===s)){if((!s||typeof s!="object")&&(s={}),s=le(s),Ge=Or.indexOf(s.PARSER_MEDIA_TYPE)===-1?Pr:s.PARSER_MEDIA_TYPE,P=Ge==="application/xhtml+xml"?Ut:bt,O=X(s,"ALLOWED_TAGS")?b({},s.ALLOWED_TAGS,P):cn,N=X(s,"ALLOWED_ATTR")?b({},s.ALLOWED_ATTR,P):ln,Lt=X(s,"ALLOWED_NAMESPACES")?b({},s.ALLOWED_NAMESPACES,Ut):Cr,Ot=X(s,"ADD_URI_SAFE_ATTR")?b(le(Sn),s.ADD_URI_SAFE_ATTR,P):Sn,yn=X(s,"ADD_DATA_URI_TAGS")?b(le(gn),s.ADD_DATA_URI_TAGS,P):gn,Ie=X(s,"FORBID_CONTENTS")?b({},s.FORBID_CONTENTS,P):pn,Fe=X(s,"FORBID_TAGS")?b({},s.FORBID_TAGS,P):le({}),_t=X(s,"FORBID_ATTR")?b({},s.FORBID_ATTR,P):le({}),Ce=X(s,"USE_PROFILES")?s.USE_PROFILES:!1,un=s.ALLOW_ARIA_ATTR!==!1,vt=s.ALLOW_DATA_ATTR!==!1,fn=s.ALLOW_UNKNOWN_PROTOCOLS||!1,dn=s.ALLOW_SELF_CLOSE_IN_ATTR!==!1,ve=s.SAFE_FOR_TEMPLATES||!1,ct=s.SAFE_FOR_XML!==!1,we=s.WHOLE_DOCUMENT||!1,xe=s.RETURN_DOM||!1,lt=s.RETURN_DOM_FRAGMENT||!1,ut=s.RETURN_TRUSTED_TYPE||!1,Ct=s.FORCE_BODY||!1,hn=s.SANITIZE_DOM!==!1,mn=s.SANITIZE_NAMED_PROPS||!1,It=s.KEEP_CONTENT!==!1,Je=s.IN_PLACE||!1,on=s.ALLOWED_URI_REGEXP||cr,Oe=s.NAMESPACE||se,ht=s.MATHML_TEXT_INTEGRATION_POINTS||ht,mt=s.HTML_INTEGRATION_POINTS||mt,_=s.CUSTOM_ELEMENT_HANDLING||{},s.CUSTOM_ELEMENT_HANDLING&&En(s.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(_.tagNameCheck=s.CUSTOM_ELEMENT_HANDLING.tagNameCheck),s.CUSTOM_ELEMENT_HANDLING&&En(s.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(_.attributeNameCheck=s.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),s.CUSTOM_ELEMENT_HANDLING&&typeof s.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(_.allowCustomizedBuiltInElements=s.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),ve&&(vt=!1),lt&&(xe=!0),Ce&&(O=b({},Kn),N=[],Ce.html===!0&&(b(O,kn),b(N,Un)),Ce.svg===!0&&(b(O,Wt),b(N,Ft),b(N,yt)),Ce.svgFilters===!0&&(b(O,Ht),b(N,Ft),b(N,yt)),Ce.mathMl===!0&&(b(O,$t),b(N,Wn),b(N,yt))),s.ADD_TAGS&&(O===cn&&(O=le(O)),b(O,s.ADD_TAGS,P)),s.ADD_ATTR&&(N===ln&&(N=le(N)),b(N,s.ADD_ATTR,P)),s.ADD_URI_SAFE_ATTR&&b(Ot,s.ADD_URI_SAFE_ATTR,P),s.FORBID_CONTENTS&&(Ie===pn&&(Ie=le(Ie)),b(Ie,s.FORBID_CONTENTS,P)),It&&(O["#text"]=!0),we&&b(O,["html","head","body"]),O.table&&(b(O,["tbody"]),delete Fe.tbody),s.TRUSTED_TYPES_POLICY){if(typeof s.TRUSTED_TYPES_POLICY.createHTML!="function")throw qe('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof s.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw qe('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');I=s.TRUSTED_TYPES_POLICY,Z=I.createHTML("")}else I===void 0&&(I=fa(g,a)),I!==null&&typeof Z=="string"&&(Z=I.createHTML(""));W&&W(s),Pe=s}},bn=b({},[...Wt,...Ht,...ea]),wn=b({},[...$t,...ta]),Nr=function(s){let f=z(s);(!f||!f.tagName)&&(f={namespaceURI:Oe,tagName:"template"});const h=bt(s.tagName),R=bt(f.tagName);return Lt[s.namespaceURI]?s.namespaceURI===dt?f.namespaceURI===se?h==="svg":f.namespaceURI===ft?h==="svg"&&(R==="annotation-xml"||ht[R]):!!bn[h]:s.namespaceURI===ft?f.namespaceURI===se?h==="math":f.namespaceURI===dt?h==="math"&&mt[R]:!!wn[h]:s.namespaceURI===se?f.namespaceURI===dt&&!mt[R]||f.namespaceURI===ft&&!ht[R]?!1:!wn[h]&&(Ir[h]||!bn[h]):!!(Ge==="application/xhtml+xml"&&Lt[s.namespaceURI]):!1},Q=function(s){Be(t.removed,{element:s});try{z(s).removeChild(s)}catch{$(s)}},Le=function(s,f){try{Be(t.removed,{attribute:f.getAttributeNode(s),from:f})}catch{Be(t.removed,{attribute:null,from:f})}if(f.removeAttribute(s),s==="is")if(xe||lt)try{Q(f)}catch{}else try{f.setAttribute(s,"")}catch{}},An=function(s){let f=null,h=null;if(Ct)s="<remove></remove>"+s;else{const x=Mn(s,/^[\r\n\t ]+/);h=x&&x[0]}Ge==="application/xhtml+xml"&&Oe===se&&(s='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+s+"</body></html>");const R=I?I.createHTML(s):s;if(Oe===se)try{f=new S().parseFromString(R,Ge)}catch{}if(!f||!f.documentElement){f=me.createDocument(Oe,"template",null);try{f.documentElement.innerHTML=Pt?Z:R}catch{}}const k=f.body||f.documentElement;return s&&h&&k.insertBefore(n.createTextNode(h),k.childNodes[0]||null),Oe===se?ae.call(f,we?"html":"body")[0]:we?f.documentElement:k},Tn=function(s){return Tt.call(s.ownerDocument||s,s,u.SHOW_ELEMENT|u.SHOW_COMMENT|u.SHOW_TEXT|u.SHOW_PROCESSING_INSTRUCTION|u.SHOW_CDATA_SECTION,null)},Dt=function(s){return s instanceof p&&(typeof s.nodeName!="string"||typeof s.textContent!="string"||typeof s.removeChild!="function"||!(s.attributes instanceof d)||typeof s.removeAttribute!="function"||typeof s.setAttribute!="function"||typeof s.namespaceURI!="string"||typeof s.insertBefore!="function"||typeof s.hasChildNodes!="function")},Rn=function(s){return typeof c=="function"&&s instanceof c};function ie(y,s,f){pt(y,h=>{h.call(t,s,f,Pe)})}const _n=function(s){let f=null;if(ie(v.beforeSanitizeElements,s,null),Dt(s))return Q(s),!0;const h=P(s.nodeName);if(ie(v.uponSanitizeElement,s,{tagName:h,allowedTags:O}),ct&&s.hasChildNodes()&&!Rn(s.firstElementChild)&&U(/<[/\w!]/g,s.innerHTML)&&U(/<[/\w!]/g,s.textContent)||s.nodeType===Xe.progressingInstruction||ct&&s.nodeType===Xe.comment&&U(/<[/\w]/g,s.data))return Q(s),!0;if(!O[h]||Fe[h]){if(!Fe[h]&&xn(h)&&(_.tagNameCheck instanceof RegExp&&U(_.tagNameCheck,h)||_.tagNameCheck instanceof Function&&_.tagNameCheck(h)))return!1;if(It&&!Ie[h]){const R=z(s)||s.parentNode,k=Te(s)||s.childNodes;if(k&&R){const x=k.length;for(let F=x-1;F>=0;--F){const oe=w(k[F],!0);oe.__removalCount=(s.__removalCount||0)+1,R.insertBefore(oe,he(s))}}}return Q(s),!0}return s instanceof l&&!Nr(s)||(h==="noscript"||h==="noembed"||h==="noframes")&&U(/<\/no(script|embed|frames)/i,s.innerHTML)?(Q(s),!0):(ve&&s.nodeType===Xe.text&&(f=s.textContent,pt([We,_e,He],R=>{f=Ve(f,R," ")}),s.textContent!==f&&(Be(t.removed,{element:s.cloneNode()}),s.textContent=f)),ie(v.afterSanitizeElements,s,null),!1)},vn=function(s,f,h){if(hn&&(f==="id"||f==="name")&&(h in n||h in Lr))return!1;if(!(vt&&!_t[f]&&U(ot,f))){if(!(un&&U(Rt,f))){if(!N[f]||_t[f]){if(!(xn(s)&&(_.tagNameCheck instanceof RegExp&&U(_.tagNameCheck,s)||_.tagNameCheck instanceof Function&&_.tagNameCheck(s))&&(_.attributeNameCheck instanceof RegExp&&U(_.attributeNameCheck,f)||_.attributeNameCheck instanceof Function&&_.attributeNameCheck(f))||f==="is"&&_.allowCustomizedBuiltInElements&&(_.tagNameCheck instanceof RegExp&&U(_.tagNameCheck,h)||_.tagNameCheck instanceof Function&&_.tagNameCheck(h))))return!1}else if(!Ot[f]){if(!U(on,Ve(h,$e,""))){if(!((f==="src"||f==="xlink:href"||f==="href")&&s!=="script"&&Xr(h,"data:")===0&&yn[s])){if(!(fn&&!U(be,Ve(h,$e,"")))){if(h)return!1}}}}}}return!0},xn=function(s){return s!=="annotation-xml"&&Mn(s,vr)},Cn=function(s){ie(v.beforeSanitizeAttributes,s,null);const{attributes:f}=s;if(!f||Dt(s))return;const h={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:N,forceKeepAttr:void 0};let R=f.length;for(;R--;){const k=f[R],{name:x,namespaceURI:F,value:oe}=k,ze=P(x),Mt=oe;let K=x==="value"?Mt:Zr(Mt);if(h.attrName=ze,h.attrValue=K,h.keepAttr=!0,h.forceKeepAttr=void 0,ie(v.uponSanitizeAttribute,s,h),K=h.attrValue,mn&&(ze==="id"||ze==="name")&&(Le(x,s),K=xr+K),ct&&U(/((--!?|])>)|<\/(style|title)/i,K)){Le(x,s);continue}if(h.forceKeepAttr)continue;if(!h.keepAttr){Le(x,s);continue}if(!dn&&U(/\/>/i,K)){Le(x,s);continue}ve&&pt([We,_e,He],On=>{K=Ve(K,On," ")});const In=P(s.nodeName);if(!vn(In,ze,K)){Le(x,s);continue}if(I&&typeof g=="object"&&typeof g.getAttributeType=="function"&&!F)switch(g.getAttributeType(In,ze)){case"TrustedHTML":{K=I.createHTML(K);break}case"TrustedScriptURL":{K=I.createScriptURL(K);break}}if(K!==Mt)try{F?s.setAttributeNS(F,x,K):s.setAttribute(x,K),Dt(s)?Q(s):Dn(t.removed)}catch{Le(x,s)}}ie(v.afterSanitizeAttributes,s,null)},Dr=function y(s){let f=null;const h=Tn(s);for(ie(v.beforeSanitizeShadowDOM,s,null);f=h.nextNode();)ie(v.uponSanitizeShadowNode,f,null),_n(f),Cn(f),f.content instanceof i&&y(f.content);ie(v.afterSanitizeShadowDOM,s,null)};return t.sanitize=function(y){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},f=null,h=null,R=null,k=null;if(Pt=!y,Pt&&(y="<!-->"),typeof y!="string"&&!Rn(y))if(typeof y.toString=="function"){if(y=y.toString(),typeof y!="string")throw qe("dirty is not a string, aborting")}else throw qe("toString is not a function");if(!t.isSupported)return y;if(xt||Nt(s),t.removed=[],typeof y=="string"&&(Je=!1),Je){if(y.nodeName){const oe=P(y.nodeName);if(!O[oe]||Fe[oe])throw qe("root node is forbidden and cannot be sanitized in-place")}}else if(y instanceof c)f=An("<!---->"),h=f.ownerDocument.importNode(y,!0),h.nodeType===Xe.element&&h.nodeName==="BODY"||h.nodeName==="HTML"?f=h:f.appendChild(h);else{if(!xe&&!ve&&!we&&y.indexOf("<")===-1)return I&&ut?I.createHTML(y):y;if(f=An(y),!f)return xe?null:ut?Z:""}f&&Ct&&Q(f.firstChild);const x=Tn(Je?y:f);for(;R=x.nextNode();)_n(R),Cn(R),R.content instanceof i&&Dr(R.content);if(Je)return y;if(xe){if(lt)for(k=re.call(f.ownerDocument);f.firstChild;)k.appendChild(f.firstChild);else k=f;return(N.shadowroot||N.shadowrootmode)&&(k=Re.call(r,k,!0)),k}let F=we?f.outerHTML:f.innerHTML;return we&&O["!doctype"]&&f.ownerDocument&&f.ownerDocument.doctype&&f.ownerDocument.doctype.name&&U(lr,f.ownerDocument.doctype.name)&&(F="<!DOCTYPE "+f.ownerDocument.doctype.name+`>
`+F),ve&&pt([We,_e,He],oe=>{F=Ve(F,oe," ")}),I&&ut?I.createHTML(F):F},t.setConfig=function(){let y=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Nt(y),xt=!0},t.clearConfig=function(){Pe=null,xt=!1},t.isValidAttribute=function(y,s,f){Pe||Nt({});const h=P(y),R=P(s);return vn(h,R,f)},t.addHook=function(y,s){typeof s=="function"&&Be(v[y],s)},t.removeHook=function(y,s){if(s!==void 0){const f=qr(v[y],s);return f===-1?void 0:Yr(v[y],f,1)[0]}return Dn(v[y])},t.removeHooks=function(y){v[y]=[]},t.removeAllHooks=function(){v=$n()},t}var da=ur();class Jt{constructor(){this.queue=[],this.cache=null}combine(t,n){return[t[0]*n[0]+t[2]*n[1],t[1]*n[0]+t[3]*n[1],t[0]*n[2]+t[2]*n[3],t[1]*n[2]+t[3]*n[3],t[0]*n[4]+t[2]*n[5]+t[4],t[1]*n[4]+t[3]*n[5]+t[5]]}isIdentity(){this.cache||(this.cache=this.toArray());const t=this.cache;return t[0]===1&&t[1]===0&&t[2]===0&&t[3]===1&&t[4]===0&&t[5]===0}matrix(t){return t[0]===1&&t[1]===0&&t[2]===0&&t[3]===1&&t[4]===0&&t[5]===0?this:(this.cache=null,this.queue.push(t),this)}translate(t,n){return(t!==0||n!==0)&&(this.cache=null,this.queue.push([1,0,0,1,t,n])),this}scale(t,n){return(t!==1||n!==1)&&(this.cache=null,this.queue.push([t,0,0,n,0,0])),this}rotate(t,n,r){if(t!==0){this.translate(n,r);const a=t*Math.PI/180,i=Math.cos(a),o=Math.sin(a);this.queue.push([i,o,-o,i,0,0]),this.cache=null,this.translate(-n,-r)}return this}skewX(t){return t!==0&&(this.cache=null,this.queue.push([1,0,Math.tan(t*Math.PI/180),1,0,0])),this}skewY(t){return t!==0&&(this.cache=null,this.queue.push([1,Math.tan(t*Math.PI/180),0,1,0,0])),this}toArray(){if(this.cache)return this.cache;if(!this.queue.length)return this.cache=[1,0,0,1,0,0],this.cache;if(this.cache=this.queue[0],this.queue.length===1)return this.cache;for(let t=1;t<this.queue.length;t++)this.cache=this.combine(this.cache,this.queue[t]);return this.cache}calc(t,n,r=!1){if(!this.queue.length)return[t,n];this.cache||(this.cache=this.toArray());const a=this.cache;return[t*a[0]+n*a[2]+(r?0:a[4]),t*a[1]+n*a[3]+(r?0:a[5])]}}const De=1e-9;function C(e,t,n=De){return Math.abs(e-t)<n}function Fn(e,t,n){const r=e.x-t.x,a=e.y-t.y;return r*r+a*a<n*n}function gt(e){return e*(Math.PI/180)}function Jn(e){return e*(180/Math.PI)}function ha(e,t,n){if(C(e.x,t.x)&&C(n.x,e.x))return!C(n.y,t.y)&&!C(n.y,e.y)&&n.y<Math.max(t.y,e.y)&&n.y>Math.min(t.y,e.y);if(C(e.y,t.y)&&C(n.y,e.y))return!C(n.x,t.x)&&!C(n.x,e.x)&&n.x<Math.max(t.x,e.x)&&n.x>Math.min(t.x,e.x);if(n.x<e.x&&n.x<t.x||n.x>e.x&&n.x>t.x||n.y<e.y&&n.y<t.y||n.y>e.y&&n.y>t.y||C(n.x,e.x)&&C(n.y,e.y)||C(n.x,t.x)&&C(n.y,t.y))return!1;const r=(n.y-e.y)*(t.x-e.x)-(n.x-e.x)*(t.y-e.y);if(Math.abs(r)>De)return!1;const a=(n.x-e.x)*(t.x-e.x)+(n.y-e.y)*(t.y-e.y);if(a<0||C(a,0))return!1;const i=(t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y);return!(a>i||C(a,i))}function ma(e,t,n,r,a){const i=t.y-e.y,o=e.x-t.x,c=t.x*e.y-e.x*t.y,l=r.y-n.y,u=n.x-r.x,d=r.x*n.y-n.x*r.y,p=i*u-l*o,S=(o*d-u*c)/p,g=(l*c-i*d)/p;return!isFinite(S)||!isFinite(g)||!a&&(Math.abs(e.x-t.x)>De&&(e.x<t.x?S<e.x||S>t.x:S>e.x||S<t.x)||Math.abs(e.y-t.y)>De&&(e.y<t.y?g<e.y||g>t.y:g>e.y||g<t.y)||Math.abs(n.x-r.x)>De&&(n.x<r.x?S<n.x||S>r.x:S>n.x||S<r.x)||Math.abs(n.y-r.y)>De&&(n.y<r.y?g<n.y||g>r.y:g>n.y||g<r.y))?null:{x:S,y:g}}const Gn={withinDistance:Fn,lineIntersect:ma,almostEqual:C,QuadraticBezier:{isFlat:function(e,t,n,r){r=4*r*r;let a=2*n.x-e.x-t.x;a*=a;let i=2*n.y-e.y-t.y;return i*=i,a+i<=r},linearize:function(e,t,n,r){const a=[e],i=[{p1:e,p2:t,c1:n}];for(;i.length>0;){const o=i[0];if(this.isFlat(o.p1,o.p2,o.c1,r))a.push({x:o.p2.x,y:o.p2.y}),i.shift();else{const c=this.subdivide(o.p1,o.p2,o.c1,.5);i.splice(0,1,c[0],c[1])}}return a},subdivide:function(e,t,n,r){const a={x:e.x+(n.x-e.x)*r,y:e.y+(n.y-e.y)*r},i={x:n.x+(t.x-n.x)*r,y:n.y+(t.y-n.y)*r},o={x:a.x+(i.x-a.x)*r,y:a.y+(i.y-a.y)*r};return[{p1:e,p2:o,c1:a},{p1:o,p2:t,c1:i}]}},CubicBezier:{isFlat:function(e,t,n,r,a){a=16*a*a;let i=3*n.x-2*e.x-t.x;i*=i;let o=3*n.y-2*e.y-t.y;o*=o;let c=3*r.x-2*t.x-e.x;c*=c;let l=3*r.y-2*t.y-e.y;return l*=l,i<c&&(i=c),o<l&&(o=l),i+o<=a},linearize:function(e,t,n,r,a){const i=[e],o=[{p1:e,p2:t,c1:n,c2:r}];for(;o.length>0;){const c=o[0];if(this.isFlat(c.p1,c.p2,c.c1,c.c2,a))i.push({x:c.p2.x,y:c.p2.y}),o.shift();else{const l=this.subdivide(c.p1,c.p2,c.c1,c.c2,.5);o.splice(0,1,l[0],l[1])}}return i},subdivide:function(e,t,n,r,a){const i={x:e.x+(n.x-e.x)*a,y:e.y+(n.y-e.y)*a},o={x:r.x+(t.x-r.x)*a,y:r.y+(t.y-r.y)*a},c={x:n.x+(r.x-n.x)*a,y:n.y+(r.y-n.y)*a},l={x:i.x+(c.x-i.x)*a,y:i.y+(c.y-i.y)*a},u={x:c.x+(o.x-c.x)*a,y:c.y+(o.y-c.y)*a},d={x:l.x+(u.x-l.x)*a,y:l.y+(u.y-l.y)*a};return[{p1:e,p2:d,c1:i,c2:l},{p1:d,p2:t,c1:u,c2:o}]}},Arc:{linearize:function(e,t,n,r,a,i,o,c){const l=[t];let u=this.svgToCenter(e,t,n,r,a,i,o);const d=[u];for(;d.length>0;){u=d[0];const p=this.centerToSvg(u.center,u.rx,u.ry,u.theta,u.extent,u.angle),g=this.centerToSvg(u.center,u.rx,u.ry,u.theta,.5*u.extent,u.angle).p2,E={x:.5*(p.p1.x+p.p2.x),y:.5*(p.p1.y+p.p2.y)};if(Fn(E,g,c))l.unshift(p.p2),d.shift();else{const w={...u,extent:.5*u.extent},$={...u,theta:u.theta+.5*u.extent,extent:.5*u.extent};d.splice(0,1,w,$)}}return l},centerToSvg:function(e,t,n,r,a,i){const o=r+a,c=gt(r),l=gt(o),u=gt(i),d=Math.cos(u),p=Math.sin(u),S=Math.cos(c),g=Math.sin(c),E=Math.cos(l),w=Math.sin(l),$=e.x+d*t*S+-p*n*g,he=e.y+p*t*S+d*n*g,Te=e.x+d*t*E+-p*n*w,z=e.y+p*t*E+d*n*w;return{p1:{x:$,y:he},p2:{x:Te,y:z},rx:t,ry:n,angle:i,largearc:a>180?1:0,sweep:a>0?1:0}},svgToCenter:function(e,t,n,r,a,i,o){const c={x:.5*(e.x-t.x),y:.5*(e.y-t.y)},l=gt(a%360),u=Math.cos(l),d=Math.sin(l),p=u*c.x+d*c.y,S=-d*c.x+u*c.y;n=Math.abs(n),r=Math.abs(r);let g=n*n,E=r*r,w=p*p,$=S*S;const he=w/g+$/E;if(he>1){const $e=Math.sqrt(he);n=$e*n,r=$e*r,g=n*n,E=r*r}const Te=i===o?-1:1;let z=(g*E-g*$-E*w)/(g*$+E*w);z=z<0?0:z;const I=Te*Math.sqrt(z),Z=I*(n*S/r),me=I*-(r*p/n),Tt={x:(e.x+t.x)/2+(u*Z-d*me),y:(e.y+t.y)/2+(d*Z+u*me)},re=(p-Z)/n,ae=(S-me)/r,Re=(-p-Z)/n,v=(-S-me)/r,We=Math.sqrt(re*re+ae*ae);let _e=Math.acos(re/We);ae<0&&(_e*=-1);const He=Math.sqrt((re*re+ae*ae)*(Re*Re+v*v));let ot=Math.acos((re*Re+ae*v)/He);re*v-ae*Re<0&&(ot*=-1);let Rt=Jn(_e),be=Jn(ot%(2*Math.PI));return!o&&be>0&&(be-=360),o&&be<0&&(be+=360),{center:Tt,rx:n,ry:r,theta:Rt,extent:be,angle:a}}},getPolygonBounds:function(e){if(!e||e.length<1)return null;let t=e[0].x,n=e[0].x,r=e[0].y,a=e[0].y;for(let i=1;i<e.length;i++)e[i].x>n?n=e[i].x:e[i].x<t&&(t=e[i].x),e[i].y>a?a=e[i].y:e[i].y<r&&(r=e[i].y);return{x:t,y:r,width:n-t,height:a-r}},pointInPolygon:function(e,t){if(!t||t.length<3)return null;let n=!1;const r=t.offsetx||0,a=t.offsety||0;for(let i=0,o=t.length-1;i<t.length;o=i++){const c=t[i].x+r,l=t[i].y+a,u=t[o].x+r,d=t[o].y+a;if(C(c,e.x)&&C(l,e.y)||ha({x:c,y:l},{x:u,y:d},e))return null;if(C(c,u)&&C(l,d))continue;l>e.y!=d>e.y&&e.x<(u-c)*(e.y-l)/(d-l)+c&&(n=!n)}return n},polygonArea:function(e){let t=0;for(let n=0,r=e.length-1;n<e.length;r=n++)t+=(e[r].x+e[n].x)*(e[r].y-e[n].y);return .5*t}};class pa{constructor(){this.svg=null,this.svgRoot=null,this.allowedElements=["svg","circle","ellipse","path","polygon","polyline","rect","line"],this.conf={tolerance:2,toleranceSvg:.005}}config(t){t&&t.tolerance&&(this.conf.tolerance=t.tolerance)}load(t){if(!t||typeof t!="string")throw new Error("Invalid SVG string");const r=new DOMParser().parseFromString(t,"image/svg+xml");if(!r||r.querySelector("parsererror"))throw new Error("Failed to parse SVG string");if(this.svg=r,this.svgRoot=r.querySelector("svg"),!this.svgRoot)throw new Error("No SVG root element found in the provided string");return this.svgRoot}cleanInput(){return this.svgRoot?(this.applyTransform(this.svgRoot),this.flatten(this.svgRoot),this.filter(this.allowedElements),this.recurse(this.svgRoot,t=>this.splitPath(t)),this.svgRoot):null}getStyle(){return this.svgRoot?this.svgRoot.querySelector("style"):!1}pathToAbsolute(t){if(!t||t.tagName!=="path"||!t.pathSegList){console.warn("SvgParser.pathToAbsolute: pathSegList API is deprecated and may not be supported.");return}let n=0,r=0,a=0,i=0;const o=t.pathSegList;for(let c=0;c<o.numberOfItems;c++){const l=o.getItem(c),u=l.pathSegTypeAsLetter;if(/[MLHVCSQTA]/.test(u))"x"in l&&(n=l.x),"y"in l&&(r=l.y);else{let d="x1"in l?n+l.x1:0,p="y1"in l?r+l.y1:0,S="x2"in l?n+l.x2:0,g="y2"in l?r+l.y2:0;switch("x"in l&&(n+=l.x),"y"in l&&(r+=l.y),u){case"m":o.replaceItem(t.createSVGPathSegMovetoAbs(n,r),c);break;case"l":o.replaceItem(t.createSVGPathSegLinetoAbs(n,r),c);break;case"h":o.replaceItem(t.createSVGPathSegLinetoHorizontalAbs(n),c);break;case"v":o.replaceItem(t.createSVGPathSegLinetoVerticalAbs(r),c);break;case"c":o.replaceItem(t.createSVGPathSegCurvetoCubicAbs(n,r,d,p,S,g),c);break;case"s":o.replaceItem(t.createSVGPathSegCurvetoCubicSmoothAbs(n,r,S,g),c);break;case"q":o.replaceItem(t.createSVGPathSegCurvetoQuadraticAbs(n,r,d,p),c);break;case"t":o.replaceItem(t.createSVGPathSegCurvetoQuadraticSmoothAbs(n,r),c);break;case"a":o.replaceItem(t.createSVGPathSegArcAbs(n,r,l.r1,l.r2,l.angle,l.largeArcFlag,l.sweepFlag),c);break;case"z":case"Z":n=a,r=i;break}}u.toUpperCase()==="M"&&(a=n,i=r)}}transformParse(t){const n=/\s*(matrix|translate|scale|rotate|skewX|skewY)\s*\(\s*(.*?)\s*\)[\s,]*/,r=/[\s,]+/,a=new Jt;let i="";return t.split(n).forEach(o=>{if(!o||!o.length)return;if(["matrix","translate","scale","rotate","skewX","skewY"].includes(o)){i=o;return}const c=o.split(r).map(l=>+l||0);switch(i){case"matrix":c.length===6&&a.matrix(c);break;case"scale":a.scale(c[0],c.length>1?c[1]:c[0]);break;case"rotate":a.rotate(c[0],c[1]||0,c[2]||0);break;case"translate":a.translate(c[0],c[1]||0);break;case"skewX":c.length===1&&a.skewX(c[0]);break;case"skewY":c.length===1&&a.skewY(c[0]);break}}),a}applyTransform(t,n=new Jt){const r=t.getAttribute("transform");let a=n;if(r){const i=this.transformParse(r);a=new Jt;const o=a.combine(n.toArray(),i.toArray());a.matrix(o)}["g","svg","defs"].includes(t.tagName)?t.removeAttribute("transform"):a.isIdentity()||(console.warn(`Applying transform to <${t.tagName}>. For full accuracy, convert shape to path first.`),t.removeAttribute("transform"));for(const i of Array.from(t.children))this.applyTransform(i,a)}flatten(t){if(t.tagName==="g"&&t.parentElement){for(;t.firstChild;)t.parentElement.insertBefore(t.firstChild,t);t.parentElement.removeChild(t)}for(const n of Array.from(t.children))this.flatten(n)}filter(t,n=this.svgRoot){const r=Array.from(n.children);for(const a of r)this.filter(t,a);!t.includes(n.tagName)&&n.parentElement&&n.parentElement.removeChild(n)}splitPath(t){if(t.tagName!=="path"||!t.parentElement||!t.pathSegList)return;const n=Array.from(t.pathSegList);if(n.filter(i=>i.pathSegTypeAsLetter.toUpperCase()==="M").length<=1)return;const r=[];let a=null;n.forEach(i=>{if(i.pathSegTypeAsLetter.toUpperCase()==="M"){a=t.cloneNode(!1),a.setAttribute("d","");for(const c of t.attributes)c.name!=="d"&&a.setAttribute(c.name,c.value);r.push(a)}a.pathSegList.appendItem(i)}),r.forEach(i=>t.parentElement.insertBefore(i,t)),t.parentElement.removeChild(t)}recurse(t,n){Array.from(t.children).forEach(a=>this.recurse(a,n)),n(t)}polygonify(t){const n=[];switch(t.tagName){case"polygon":case"polyline":for(const S of t.points)n.push({x:S.x,y:S.y});break;case"rect":const r=parseFloat(t.getAttribute("x"))||0,a=parseFloat(t.getAttribute("y"))||0,i=parseFloat(t.getAttribute("width")),o=parseFloat(t.getAttribute("height"));n.push({x:r,y:a},{x:r+i,y:a},{x:r+i,y:a+o},{x:r,y:a+o});break;case"circle":case"ellipse":const c=parseFloat(t.getAttribute("cx")),l=parseFloat(t.getAttribute("cy")),u=parseFloat(t.getAttribute("rx")||t.getAttribute("r")),d=parseFloat(t.getAttribute("ry")||t.getAttribute("r")),p=Math.ceil(2*Math.PI/Math.acos(1-this.conf.tolerance/Math.max(u,d)));for(let S=0;S<Math.max(p,3);S++){const g=S*(2*Math.PI)/p;n.push({x:u*Math.cos(g)+c,y:d*Math.sin(g)+l})}break;case"path":console.warn("Polygonify for <path> elements is complex and not fully implemented in this version.");break}return n.length>1&&Gn.almostEqual(n[0].x,n[n.length-1].x,this.conf.toleranceSvg)&&Gn.almostEqual(n[0].y,n[n.length-1].y,this.conf.toleranceSvg)&&n.pop(),n}}const St=new TextEncoder,je=new TextDecoder;function ya(...e){const t=e.reduce((a,{length:i})=>a+i,0),n=new Uint8Array(t);let r=0;for(const a of e)n.set(a,r),r+=a.length;return n}function ga(e){if(Uint8Array.fromBase64)return Uint8Array.fromBase64(e);const t=atob(e),n=new Uint8Array(t.length);for(let r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return n}function Qe(e){if(Uint8Array.fromBase64)return Uint8Array.fromBase64(typeof e=="string"?e:je.decode(e),{alphabet:"base64url"});let t=e;t instanceof Uint8Array&&(t=je.decode(t)),t=t.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return ga(t)}catch{throw new TypeError("The input to be decoded is not correctly encoded.")}}class V extends Error{constructor(n,r){var a;super(n,r);T(this,"code","ERR_JOSE_GENERIC");this.name=this.constructor.name,(a=Error.captureStackTrace)==null||a.call(Error,this,this.constructor)}}T(V,"code","ERR_JOSE_GENERIC");class Y extends V{constructor(n,r,a="unspecified",i="unspecified"){super(n,{cause:{claim:a,reason:i,payload:r}});T(this,"code","ERR_JWT_CLAIM_VALIDATION_FAILED");T(this,"claim");T(this,"reason");T(this,"payload");this.claim=a,this.reason=i,this.payload=r}}T(Y,"code","ERR_JWT_CLAIM_VALIDATION_FAILED");class qt extends V{constructor(n,r,a="unspecified",i="unspecified"){super(n,{cause:{claim:a,reason:i,payload:r}});T(this,"code","ERR_JWT_EXPIRED");T(this,"claim");T(this,"reason");T(this,"payload");this.claim=a,this.reason=i,this.payload=r}}T(qt,"code","ERR_JWT_EXPIRED");class ne extends V{constructor(){super(...arguments);T(this,"code","ERR_JOSE_NOT_SUPPORTED")}}T(ne,"code","ERR_JOSE_NOT_SUPPORTED");class L extends V{constructor(){super(...arguments);T(this,"code","ERR_JWS_INVALID")}}T(L,"code","ERR_JWS_INVALID");class jt extends V{constructor(){super(...arguments);T(this,"code","ERR_JWT_INVALID")}}T(jt,"code","ERR_JWT_INVALID");class en extends V{constructor(){super(...arguments);T(this,"code","ERR_JWKS_INVALID")}}T(en,"code","ERR_JWKS_INVALID");class tn extends V{constructor(n="no applicable key found in the JSON Web Key Set",r){super(n,r);T(this,"code","ERR_JWKS_NO_MATCHING_KEY")}}T(tn,"code","ERR_JWKS_NO_MATCHING_KEY");var jn,er;class fr extends(er=V,jn=Symbol.asyncIterator,er){constructor(n="multiple matching keys found in the JSON Web Key Set",r){super(n,r);T(this,jn);T(this,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS")}}T(fr,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS");class dr extends V{constructor(n="request timed out",r){super(n,r);T(this,"code","ERR_JWKS_TIMEOUT")}}T(dr,"code","ERR_JWKS_TIMEOUT");class hr extends V{constructor(n="signature verification failed",r){super(n,r);T(this,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED")}}T(hr,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED");function ce(e,t="algorithm.name"){return new TypeError(`CryptoKey does not support this operation, its ${t} must be ${e}`)}function Ze(e,t){return e.name===t}function Gt(e){return parseInt(e.name.slice(4),10)}function Sa(e){switch(e){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw new Error("unreachable")}}function Ea(e,t){if(!e.usages.includes(t))throw new TypeError(`CryptoKey does not support this operation, its usages must include ${t}.`)}function ba(e,t,n){switch(t){case"HS256":case"HS384":case"HS512":{if(!Ze(e.algorithm,"HMAC"))throw ce("HMAC");const r=parseInt(t.slice(2),10);if(Gt(e.algorithm.hash)!==r)throw ce(`SHA-${r}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!Ze(e.algorithm,"RSASSA-PKCS1-v1_5"))throw ce("RSASSA-PKCS1-v1_5");const r=parseInt(t.slice(2),10);if(Gt(e.algorithm.hash)!==r)throw ce(`SHA-${r}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!Ze(e.algorithm,"RSA-PSS"))throw ce("RSA-PSS");const r=parseInt(t.slice(2),10);if(Gt(e.algorithm.hash)!==r)throw ce(`SHA-${r}`,"algorithm.hash");break}case"Ed25519":case"EdDSA":{if(!Ze(e.algorithm,"Ed25519"))throw ce("Ed25519");break}case"ES256":case"ES384":case"ES512":{if(!Ze(e.algorithm,"ECDSA"))throw ce("ECDSA");const r=Sa(t);if(e.algorithm.namedCurve!==r)throw ce(r,"algorithm.namedCurve");break}default:throw new TypeError("CryptoKey does not support this operation")}Ea(e,n)}function mr(e,t,...n){var r;if(n=n.filter(Boolean),n.length>2){const a=n.pop();e+=`one of type ${n.join(", ")}, or ${a}.`}else n.length===2?e+=`one of type ${n[0]} or ${n[1]}.`:e+=`of type ${n[0]}.`;return t==null?e+=` Received ${t}`:typeof t=="function"&&t.name?e+=` Received function ${t.name}`:typeof t=="object"&&t!=null&&(r=t.constructor)!=null&&r.name&&(e+=` Received an instance of ${t.constructor.name}`),e}const wa=(e,...t)=>mr("Key must be ",e,...t);function pr(e,t,...n){return mr(`Key for the ${e} algorithm must be `,t,...n)}function yr(e){return(e==null?void 0:e[Symbol.toStringTag])==="CryptoKey"}function gr(e){return(e==null?void 0:e[Symbol.toStringTag])==="KeyObject"}const Sr=e=>yr(e)||gr(e),Aa=(...e)=>{const t=e.filter(Boolean);if(t.length===0||t.length===1)return!0;let n;for(const r of t){const a=Object.keys(r);if(!n||n.size===0){n=new Set(a);continue}for(const i of a){if(n.has(i))return!1;n.add(i)}}return!0};function Ta(e){return typeof e=="object"&&e!==null}const ge=e=>{if(!Ta(e)||Object.prototype.toString.call(e)!=="[object Object]")return!1;if(Object.getPrototypeOf(e)===null)return!0;let t=e;for(;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t},Ra=(e,t)=>{if(e.startsWith("RS")||e.startsWith("PS")){const{modulusLength:n}=t.algorithm;if(typeof n!="number"||n<2048)throw new TypeError(`${e} requires key modulusLength to be 2048 bits or larger`)}};function _a(e){let t,n;switch(e.kty){case"RSA":{switch(e.alg){case"PS256":case"PS384":case"PS512":t={name:"RSA-PSS",hash:`SHA-${e.alg.slice(-3)}`},n=e.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":t={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${e.alg.slice(-3)}`},n=e.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":t={name:"RSA-OAEP",hash:`SHA-${parseInt(e.alg.slice(-3),10)||1}`},n=e.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new ne('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"EC":{switch(e.alg){case"ES256":t={name:"ECDSA",namedCurve:"P-256"},n=e.d?["sign"]:["verify"];break;case"ES384":t={name:"ECDSA",namedCurve:"P-384"},n=e.d?["sign"]:["verify"];break;case"ES512":t={name:"ECDSA",namedCurve:"P-521"},n=e.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":t={name:"ECDH",namedCurve:e.crv},n=e.d?["deriveBits"]:[];break;default:throw new ne('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"OKP":{switch(e.alg){case"Ed25519":case"EdDSA":t={name:"Ed25519"},n=e.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":t={name:e.crv},n=e.d?["deriveBits"]:[];break;default:throw new ne('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}default:throw new ne('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:t,keyUsages:n}}const Er=async e=>{if(!e.alg)throw new TypeError('"alg" argument is required when "jwk.alg" is not present');const{algorithm:t,keyUsages:n}=_a(e),r={...e};return delete r.alg,delete r.use,crypto.subtle.importKey("jwk",r,t,e.ext??!e.d,e.key_ops??n)};async function va(e,t,n){if(!ge(e))throw new TypeError("JWK must be an object");let r;switch(t??(t=e.alg),r??(r=e.ext),e.kty){case"oct":if(typeof e.k!="string"||!e.k)throw new TypeError('missing "k" (Key Value) Parameter value');return Qe(e.k);case"RSA":if("oth"in e&&e.oth!==void 0)throw new ne('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');case"EC":case"OKP":return Er({...e,alg:t,ext:r});default:throw new ne('Unsupported "kty" (Key Type) Parameter value')}}const xa=(e,t,n,r,a)=>{if(a.crit!==void 0&&(r==null?void 0:r.crit)===void 0)throw new e('"crit" (Critical) Header Parameter MUST be integrity protected');if(!r||r.crit===void 0)return new Set;if(!Array.isArray(r.crit)||r.crit.length===0||r.crit.some(o=>typeof o!="string"||o.length===0))throw new e('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');let i;i=t;for(const o of r.crit){if(!i.has(o))throw new ne(`Extension Header Parameter "${o}" is not recognized`);if(a[o]===void 0)throw new e(`Extension Header Parameter "${o}" is missing`);if(i.get(o)&&r[o]===void 0)throw new e(`Extension Header Parameter "${o}" MUST be integrity protected`)}return new Set(r.crit)};function nn(e){return ge(e)&&typeof e.kty=="string"}function Ca(e){return e.kty!=="oct"&&typeof e.d=="string"}function Ia(e){return e.kty!=="oct"&&typeof e.d>"u"}function Oa(e){return e.kty==="oct"&&typeof e.k=="string"}let Me;const zn=async(e,t,n,r=!1)=>{Me||(Me=new WeakMap);let a=Me.get(e);if(a!=null&&a[n])return a[n];const i=await Er({...t,alg:n});return r&&Object.freeze(e),a?a[n]=i:Me.set(e,{[n]:i}),i},Pa=(e,t)=>{var o;Me||(Me=new WeakMap);let n=Me.get(e);if(n!=null&&n[t])return n[t];const r=e.type==="public",a=!!r;let i;if(e.asymmetricKeyType==="x25519"){switch(t){case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":break;default:throw new TypeError("given KeyObject instance cannot be used for this algorithm")}i=e.toCryptoKey(e.asymmetricKeyType,a,r?[]:["deriveBits"])}if(e.asymmetricKeyType==="ed25519"){if(t!=="EdDSA"&&t!=="Ed25519")throw new TypeError("given KeyObject instance cannot be used for this algorithm");i=e.toCryptoKey(e.asymmetricKeyType,a,[r?"verify":"sign"])}if(e.asymmetricKeyType==="rsa"){let c;switch(t){case"RSA-OAEP":c="SHA-1";break;case"RS256":case"PS256":case"RSA-OAEP-256":c="SHA-256";break;case"RS384":case"PS384":case"RSA-OAEP-384":c="SHA-384";break;case"RS512":case"PS512":case"RSA-OAEP-512":c="SHA-512";break;default:throw new TypeError("given KeyObject instance cannot be used for this algorithm")}if(t.startsWith("RSA-OAEP"))return e.toCryptoKey({name:"RSA-OAEP",hash:c},a,r?["encrypt"]:["decrypt"]);i=e.toCryptoKey({name:t.startsWith("PS")?"RSA-PSS":"RSASSA-PKCS1-v1_5",hash:c},a,[r?"verify":"sign"])}if(e.asymmetricKeyType==="ec"){const l=new Map([["prime256v1","P-256"],["secp384r1","P-384"],["secp521r1","P-521"]]).get((o=e.asymmetricKeyDetails)==null?void 0:o.namedCurve);if(!l)throw new TypeError("given KeyObject instance cannot be used for this algorithm");t==="ES256"&&l==="P-256"&&(i=e.toCryptoKey({name:"ECDSA",namedCurve:l},a,[r?"verify":"sign"])),t==="ES384"&&l==="P-384"&&(i=e.toCryptoKey({name:"ECDSA",namedCurve:l},a,[r?"verify":"sign"])),t==="ES512"&&l==="P-521"&&(i=e.toCryptoKey({name:"ECDSA",namedCurve:l},a,[r?"verify":"sign"])),t.startsWith("ECDH-ES")&&(i=e.toCryptoKey({name:"ECDH",namedCurve:l},a,r?[]:["deriveBits"]))}if(!i)throw new TypeError("given KeyObject instance cannot be used for this algorithm");return n?n[t]=i:Me.set(e,{[t]:i}),i},La=async(e,t)=>{if(e instanceof Uint8Array||yr(e))return e;if(gr(e)){if(e.type==="secret")return e.export();if("toCryptoKey"in e&&typeof e.toCryptoKey=="function")try{return Pa(e,t)}catch(r){if(r instanceof TypeError)throw r}let n=e.export({format:"jwk"});return zn(e,n,t)}if(nn(e))return e.k?Qe(e.k):zn(e,e,t,!0);throw new Error("unreachable")},Ne=e=>e==null?void 0:e[Symbol.toStringTag],Yt=(e,t,n)=>{var r,a;if(t.use!==void 0){let i;switch(n){case"sign":case"verify":i="sig";break;case"encrypt":case"decrypt":i="enc";break}if(t.use!==i)throw new TypeError(`Invalid key for this operation, its "use" must be "${i}" when present`)}if(t.alg!==void 0&&t.alg!==e)throw new TypeError(`Invalid key for this operation, its "alg" must be "${e}" when present`);if(Array.isArray(t.key_ops)){let i;switch(!0){case n==="verify":case e==="dir":case e.includes("CBC-HS"):i=n;break;case e.startsWith("PBES2"):i="deriveBits";break;case/^A\d{3}(?:GCM)?(?:KW)?$/.test(e):!e.includes("GCM")&&e.endsWith("KW")?i="unwrapKey":i=n;break;case n==="encrypt":i="wrapKey";break;case n==="decrypt":i=e.startsWith("RSA")?"unwrapKey":"deriveBits";break}if(i&&((a=(r=t.key_ops)==null?void 0:r.includes)==null?void 0:a.call(r,i))===!1)throw new TypeError(`Invalid key for this operation, its "key_ops" must include "${i}" when present`)}return!0},Na=(e,t,n)=>{if(!(t instanceof Uint8Array)){if(nn(t)){if(Oa(t)&&Yt(e,t,n))return;throw new TypeError('JSON Web Key for symmetric algorithms must have JWK "kty" (Key Type) equal to "oct" and the JWK "k" (Key Value) present')}if(!Sr(t))throw new TypeError(pr(e,t,"CryptoKey","KeyObject","JSON Web Key","Uint8Array"));if(t.type!=="secret")throw new TypeError(`${Ne(t)} instances for symmetric algorithms must be of type "secret"`)}},Da=(e,t,n)=>{if(nn(t))switch(n){case"decrypt":case"sign":if(Ca(t)&&Yt(e,t,n))return;throw new TypeError("JSON Web Key for this operation be a private JWK");case"encrypt":case"verify":if(Ia(t)&&Yt(e,t,n))return;throw new TypeError("JSON Web Key for this operation be a public JWK")}if(!Sr(t))throw new TypeError(pr(e,t,"CryptoKey","KeyObject","JSON Web Key"));if(t.type==="secret")throw new TypeError(`${Ne(t)} instances for asymmetric algorithms must not be of type "secret"`);if(t.type==="public")switch(n){case"sign":throw new TypeError(`${Ne(t)} instances for asymmetric algorithm signing must be of type "private"`);case"decrypt":throw new TypeError(`${Ne(t)} instances for asymmetric algorithm decryption must be of type "private"`)}if(t.type==="private")switch(n){case"verify":throw new TypeError(`${Ne(t)} instances for asymmetric algorithm verifying must be of type "public"`);case"encrypt":throw new TypeError(`${Ne(t)} instances for asymmetric algorithm encryption must be of type "public"`)}},Ma=(e,t,n)=>{e.startsWith("HS")||e==="dir"||e.startsWith("PBES2")||/^A(?:128|192|256)(?:GCM)?(?:KW)?$/.test(e)||/^A(?:128|192|256)CBC-HS(?:256|384|512)$/.test(e)?Na(e,t,n):Da(e,t,n)},ka=(e,t)=>{const n=`SHA-${e.slice(-3)}`;switch(e){case"HS256":case"HS384":case"HS512":return{hash:n,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:n,name:"RSA-PSS",saltLength:parseInt(e.slice(-3),10)>>3};case"RS256":case"RS384":case"RS512":return{hash:n,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:n,name:"ECDSA",namedCurve:t.namedCurve};case"Ed25519":case"EdDSA":return{name:"Ed25519"};default:throw new ne(`alg ${e} is not supported either by JOSE or your javascript runtime`)}},Ka=async(e,t,n)=>{if(t instanceof Uint8Array){if(!e.startsWith("HS"))throw new TypeError(wa(t,"CryptoKey","KeyObject","JSON Web Key"));return crypto.subtle.importKey("raw",t,{hash:`SHA-${e.slice(-3)}`,name:"HMAC"},!1,[n])}return ba(t,e,n),t},Ua=async(e,t,n,r)=>{const a=await Ka(e,t,"verify");Ra(e,a);const i=ka(e,a.algorithm);try{return await crypto.subtle.verify(i,a,n,r)}catch{return!1}};async function Wa(e,t,n){if(!ge(e))throw new L("Flattened JWS must be an object");if(e.protected===void 0&&e.header===void 0)throw new L('Flattened JWS must have either of the "protected" or "header" members');if(e.protected!==void 0&&typeof e.protected!="string")throw new L("JWS Protected Header incorrect type");if(e.payload===void 0)throw new L("JWS Payload missing");if(typeof e.signature!="string")throw new L("JWS Signature missing or incorrect type");if(e.header!==void 0&&!ge(e.header))throw new L("JWS Unprotected Header incorrect type");let r={};if(e.protected)try{const w=Qe(e.protected);r=JSON.parse(je.decode(w))}catch{throw new L("JWS Protected Header is invalid")}if(!Aa(r,e.header))throw new L("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");const a={...r,...e.header},i=xa(L,new Map([["b64",!0]]),n==null?void 0:n.crit,r,a);let o=!0;if(i.has("b64")&&(o=r.b64,typeof o!="boolean"))throw new L('The "b64" (base64url-encode payload) Header Parameter must be a boolean');const{alg:c}=a;if(typeof c!="string"||!c)throw new L('JWS "alg" (Algorithm) Header Parameter missing or invalid');if(o){if(typeof e.payload!="string")throw new L("JWS Payload must be a string")}else if(typeof e.payload!="string"&&!(e.payload instanceof Uint8Array))throw new L("JWS Payload must be a string or an Uint8Array instance");let l=!1;typeof t=="function"&&(t=await t(r,e),l=!0),Ma(c,t,"verify");const u=ya(St.encode(e.protected??""),St.encode("."),typeof e.payload=="string"?St.encode(e.payload):e.payload);let d;try{d=Qe(e.signature)}catch{throw new L("Failed to base64url decode the signature")}const p=await La(t,c);if(!await Ua(c,p,d,u))throw new hr;let g;if(o)try{g=Qe(e.payload)}catch{throw new L("Failed to base64url decode the payload")}else typeof e.payload=="string"?g=St.encode(e.payload):g=e.payload;const E={payload:g};return e.protected!==void 0&&(E.protectedHeader=r),e.header!==void 0&&(E.unprotectedHeader=e.header),l?{...E,key:p}:E}async function Ha(e,t,n){if(e instanceof Uint8Array&&(e=je.decode(e)),typeof e!="string")throw new L("Compact JWS must be a string or Uint8Array");const{0:r,1:a,2:i,length:o}=e.split(".");if(o!==3)throw new L("Invalid Compact JWS");const c=await Wa({payload:a,protected:r,signature:i},t,n),l={payload:c.payload,protectedHeader:c.protectedHeader};return typeof t=="function"?{...l,key:c.key}:l}const $a=e=>Math.floor(e.getTime()/1e3),br=60,wr=br*60,rn=wr*24,Fa=rn*7,Ja=rn*365.25,Ga=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i,Bn=e=>{const t=Ga.exec(e);if(!t||t[4]&&t[1])throw new TypeError("Invalid time period format");const n=parseFloat(t[2]),r=t[3].toLowerCase();let a;switch(r){case"sec":case"secs":case"second":case"seconds":case"s":a=Math.round(n);break;case"minute":case"minutes":case"min":case"mins":case"m":a=Math.round(n*br);break;case"hour":case"hours":case"hr":case"hrs":case"h":a=Math.round(n*wr);break;case"day":case"days":case"d":a=Math.round(n*rn);break;case"week":case"weeks":case"w":a=Math.round(n*Fa);break;default:a=Math.round(n*Ja);break}return t[1]==="-"||t[4]==="ago"?-a:a},Vn=e=>e.includes("/")?e.toLowerCase():`application/${e.toLowerCase()}`,za=(e,t)=>typeof e=="string"?t.includes(e):Array.isArray(e)?t.some(Set.prototype.has.bind(new Set(e))):!1;function Ba(e,t,n={}){let r;try{r=JSON.parse(je.decode(t))}catch{}if(!ge(r))throw new jt("JWT Claims Set must be a top-level JSON object");const{typ:a}=n;if(a&&(typeof e.typ!="string"||Vn(e.typ)!==Vn(a)))throw new Y('unexpected "typ" JWT header value',r,"typ","check_failed");const{requiredClaims:i=[],issuer:o,subject:c,audience:l,maxTokenAge:u}=n,d=[...i];u!==void 0&&d.push("iat"),l!==void 0&&d.push("aud"),c!==void 0&&d.push("sub"),o!==void 0&&d.push("iss");for(const E of new Set(d.reverse()))if(!(E in r))throw new Y(`missing required "${E}" claim`,r,E,"missing");if(o&&!(Array.isArray(o)?o:[o]).includes(r.iss))throw new Y('unexpected "iss" claim value',r,"iss","check_failed");if(c&&r.sub!==c)throw new Y('unexpected "sub" claim value',r,"sub","check_failed");if(l&&!za(r.aud,typeof l=="string"?[l]:l))throw new Y('unexpected "aud" claim value',r,"aud","check_failed");let p;switch(typeof n.clockTolerance){case"string":p=Bn(n.clockTolerance);break;case"number":p=n.clockTolerance;break;case"undefined":p=0;break;default:throw new TypeError("Invalid clockTolerance option type")}const{currentDate:S}=n,g=$a(S||new Date);if((r.iat!==void 0||u)&&typeof r.iat!="number")throw new Y('"iat" claim must be a number',r,"iat","invalid");if(r.nbf!==void 0){if(typeof r.nbf!="number")throw new Y('"nbf" claim must be a number',r,"nbf","invalid");if(r.nbf>g+p)throw new Y('"nbf" claim timestamp check failed',r,"nbf","check_failed")}if(r.exp!==void 0){if(typeof r.exp!="number")throw new Y('"exp" claim must be a number',r,"exp","invalid");if(r.exp<=g-p)throw new qt('"exp" claim timestamp check failed',r,"exp","check_failed")}if(u){const E=g-r.iat,w=typeof u=="number"?u:Bn(u);if(E-p>w)throw new qt('"iat" claim timestamp check failed (too far in the past)',r,"iat","check_failed");if(E<0-p)throw new Y('"iat" claim timestamp check failed (it should be in the past)',r,"iat","check_failed")}return r}async function Va(e,t,n){var o;const r=await Ha(e,t,n);if((o=r.protectedHeader.crit)!=null&&o.includes("b64")&&r.protectedHeader.b64===!1)throw new jt("JWTs MUST NOT use unencoded payload");const i={payload:Ba(r.protectedHeader,r.payload,n),protectedHeader:r.protectedHeader};return typeof t=="function"?{...i,key:r.key}:i}function qa(e){switch(typeof e=="string"&&e.slice(0,2)){case"RS":case"PS":return"RSA";case"ES":return"EC";case"Ed":return"OKP";default:throw new ne('Unsupported "alg" value for a JSON Web Key Set')}}function Ya(e){return e&&typeof e=="object"&&Array.isArray(e.keys)&&e.keys.every(Xa)}function Xa(e){return ge(e)}var ke,et;class Za{constructor(t){B(this,ke);B(this,et,new WeakMap);if(!Ya(t))throw new en("JSON Web Key Set malformed");D(this,ke,structuredClone(t))}jwks(){return A(this,ke)}async getKey(t,n){const{alg:r,kid:a}={...t,...n==null?void 0:n.header},i=qa(r),o=A(this,ke).keys.filter(u=>{let d=i===u.kty;if(d&&typeof a=="string"&&(d=a===u.kid),d&&typeof u.alg=="string"&&(d=r===u.alg),d&&typeof u.use=="string"&&(d=u.use==="sig"),d&&Array.isArray(u.key_ops)&&(d=u.key_ops.includes("verify")),d)switch(r){case"ES256":d=u.crv==="P-256";break;case"ES384":d=u.crv==="P-384";break;case"ES512":d=u.crv==="P-521";break;case"Ed25519":case"EdDSA":d=u.crv==="Ed25519";break}return d}),{0:c,length:l}=o;if(l===0)throw new tn;if(l!==1){const u=new fr,d=A(this,et);throw u[Symbol.asyncIterator]=async function*(){for(const p of o)try{yield await qn(d,p,r)}catch{}},u}return qn(A(this,et),c,r)}}ke=new WeakMap,et=new WeakMap;async function qn(e,t,n){const r=e.get(t)||e.set(t,{}).get(t);if(r[n]===void 0){const a=await va({...t,ext:!0},n);if(a instanceof Uint8Array||a.type!=="public")throw new en("JSON Web Key Set members must be public keys");r[n]=a}return r[n]}function Yn(e){const t=new Za(e),n=async(r,a)=>t.getKey(r,a);return Object.defineProperties(n,{jwks:{value:()=>structuredClone(t.jwks()),enumerable:!1,configurable:!1,writable:!1}}),n}function Qa(){return typeof WebSocketPair<"u"||typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"||typeof EdgeRuntime<"u"&&EdgeRuntime==="vercel"}let Xt;var Et,tr;(typeof navigator>"u"||!((tr=(Et=navigator.userAgent)==null?void 0:Et.startsWith)!=null&&tr.call(Et,"Mozilla/5.0 ")))&&(Xt="jose/v6.0.12");const ja=Symbol();async function es(e,t,n,r=fetch){const a=await r(e,{method:"GET",signal:n,redirect:"manual",headers:t}).catch(i=>{throw i.name==="TimeoutError"?new dr:i});if(a.status!==200)throw new V("Expected 200 OK from the JSON Web Key Set HTTP response");try{return await a.json()}catch{throw new V("Failed to parse the JSON Web Key Set HTTP response as JSON")}}const zt=Symbol();function ts(e,t){return!(typeof e!="object"||e===null||!("uat"in e)||typeof e.uat!="number"||Date.now()-e.uat>=t||!("jwks"in e)||!ge(e.jwks)||!Array.isArray(e.jwks.keys)||!Array.prototype.every.call(e.jwks.keys,ge))}var tt,nt,rt,Ke,ue,j,ee,at,fe,de;class ns{constructor(t,n){B(this,tt);B(this,nt);B(this,rt);B(this,Ke);B(this,ue);B(this,j);B(this,ee);B(this,at);B(this,fe);B(this,de);if(!(t instanceof URL))throw new TypeError("url must be an instance of URL");D(this,tt,new URL(t.href)),D(this,nt,typeof(n==null?void 0:n.timeoutDuration)=="number"?n==null?void 0:n.timeoutDuration:5e3),D(this,rt,typeof(n==null?void 0:n.cooldownDuration)=="number"?n==null?void 0:n.cooldownDuration:3e4),D(this,Ke,typeof(n==null?void 0:n.cacheMaxAge)=="number"?n==null?void 0:n.cacheMaxAge:6e5),D(this,ee,new Headers(n==null?void 0:n.headers)),Xt&&!A(this,ee).has("User-Agent")&&A(this,ee).set("User-Agent",Xt),A(this,ee).has("accept")||(A(this,ee).set("accept","application/json"),A(this,ee).append("accept","application/jwk-set+json")),D(this,at,n==null?void 0:n[ja]),(n==null?void 0:n[zt])!==void 0&&(D(this,de,n==null?void 0:n[zt]),ts(n==null?void 0:n[zt],A(this,Ke))&&(D(this,ue,A(this,de).uat),D(this,fe,Yn(A(this,de).jwks))))}pendingFetch(){return!!A(this,j)}coolingDown(){return typeof A(this,ue)=="number"?Date.now()<A(this,ue)+A(this,rt):!1}fresh(){return typeof A(this,ue)=="number"?Date.now()<A(this,ue)+A(this,Ke):!1}jwks(){var t;return(t=A(this,fe))==null?void 0:t.jwks()}async getKey(t,n){(!A(this,fe)||!this.fresh())&&await this.reload();try{return await A(this,fe).call(this,t,n)}catch(r){if(r instanceof tn&&this.coolingDown()===!1)return await this.reload(),A(this,fe).call(this,t,n);throw r}}async reload(){A(this,j)&&Qa()&&D(this,j,void 0),A(this,j)||D(this,j,es(A(this,tt).href,A(this,ee),AbortSignal.timeout(A(this,nt)),A(this,at)).then(t=>{D(this,fe,Yn(t)),A(this,de)&&(A(this,de).uat=Date.now(),A(this,de).jwks=t),D(this,ue,Date.now()),D(this,j,void 0)}).catch(t=>{throw D(this,j,void 0),t})),await A(this,j)}}tt=new WeakMap,nt=new WeakMap,rt=new WeakMap,Ke=new WeakMap,ue=new WeakMap,j=new WeakMap,ee=new WeakMap,at=new WeakMap,fe=new WeakMap,de=new WeakMap;function rs(e,t){const n=new ns(e,t),r=async(a,i)=>n.getKey(a,i);return Object.defineProperties(r,{coolingDown:{get:()=>n.coolingDown(),enumerable:!0,configurable:!1},fresh:{get:()=>n.fresh(),enumerable:!0,configurable:!1},reload:{value:()=>n.reload(),enumerable:!0,configurable:!1,writable:!1},reloading:{get:()=>n.pendingFetch(),enumerable:!0,configurable:!1},jwks:{value:()=>n.jwks(),enumerable:!0,configurable:!1,writable:!1}}),r}const G="http://localhost:3000";let Ae=localStorage.getItem("authToken"),Ar,Zt;const m={};function ye(e){const t=m.connectionStatusDot,n=m.connectionStatusText;if(!(!t||!n))switch(t.classList.remove("bg-green-500","bg-red-500","bg-yellow-500"),e){case"connected":t.classList.add("bg-green-500"),n.textContent="Connected";break;case"error":t.classList.add("bg-red-500"),n.textContent="Error";break;case"connecting":t.classList.add("bg-yellow-500"),n.textContent="Connecting...";break;default:t.classList.add("bg-yellow-500"),n.textContent="Status";break}}function pe(e){return btoa(String.fromCharCode.apply(null,new Uint8Array(e))).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}async function Se(e,t={}){if(!Zt)throw new Error("Cannot make requests: JWKS verifier is not available.");const n={"Content-Type":"application/json",...t.headers};Ae&&(n.Authorization=`Bearer ${Ae}`),t.method&&t.method!=="GET"&&(n["X-CSRF-Token"]=Ar);const r=await fetch(e,{...t,headers:n,credentials:"include"}),a=localStorage.getItem("serverSessionToken"),i=r.headers.get("X-Server-Session-Token");if(i&&a&&i!==a){console.warn("New server session token detected. Verifying signature...");try{throw await Va(i,Zt),console.log("New token is valid. Server has restarted or rotated keys. Refreshing."),localStorage.setItem("serverSessionToken",i),localStorage.removeItem("authToken"),window.location.reload(),new Error("Server restarted.")}catch(o){throw console.error("CRITICAL SECURITY ALERT: Invalid server session token signature! Halting.",o),J("Security Alert: Server identity mismatch. Disconnecting."),new Error("Invalid server token signature.")}}if(r.status===401)throw st(),J("Session expired. Please log in again."),new Error("Authentication failed");if(!r.ok){const o=await r.json().catch(()=>({error:"An unknown server error occurred."}));throw new Error(o.error||`HTTP error! Status: ${r.status}`)}if(r.status!==204)return r.json()}function an(e,t){Ae=e,localStorage.setItem("authToken",e),m.authStatus.textContent=`Welcome, ${t}!`,m.loginBtn.textContent="Log Out",m.registerBtn.style.display="block",m.loginBtn.removeEventListener("click",sn),m.loginBtn.addEventListener("click",st),Tr(),At()}function st(){Ae=null,localStorage.removeItem("authToken"),m.authStatus.textContent="",m.loginBtn.textContent="Login",m.registerBtn.style.display="none",m.loginBtn.removeEventListener("click",st),m.loginBtn.addEventListener("click",sn),m.ordersList.innerHTML="",m.noOrdersMessage.textContent="Please log in to view orders.",m.noOrdersMessage.style.display="block"}async function as(){const e=m.usernameInput.value;if(!e){J("Please enter your username.");return}Ue();try{const t=await Se(`${G}/api/auth/login-options?username=${encodeURIComponent(e)}`);if(t.allowCredentials&&t.allowCredentials.length===0){Ee(),J("No security key registered for this user. Please register a key first.");return}const n=await Gr(t),r={username:e,id:n.id,rawId:pe(n.rawId),type:n.type,response:{clientDataJSON:pe(n.response.clientDataJSON),authenticatorData:pe(n.response.authenticatorData),signature:pe(n.response.signature),userHandle:n.response.userHandle?pe(n.response.userHandle):null}},a=await Se(`${G}/api/auth/login-verify`,{method:"POST",body:JSON.stringify(r)});if(a.verified)an(a.token,e),it("Successfully logged in with Security Key!");else throw new Error(a.error||"WebAuthn verification failed.")}catch(t){J(`WebAuthn Login Failed: ${t.message}`),console.error(t)}finally{Ee()}}async function ss(){const e=m.usernameInput.value,t=m.passwordInput.value;if(!e||!t){J("Username and password are required.");return}Ue();try{const n=await Se(`${G}/api/auth/login`,{method:"POST",body:JSON.stringify({username:e,password:t})});if(n.token)an(n.token,e),it("Login successful!");else throw new Error("Password verification failed.")}catch(n){J(`Password Login Failed: ${n.message}`),console.error(n)}finally{Ee()}}async function Xn(){const e=m.usernameInput.value;if(!e){J("Please enter a username to register a key.");return}Ue();try{const t=await Se(`${G}/api/auth/pre-register`,{method:"POST",body:JSON.stringify({username:e})}),n=await $r(t),r={username:e,id:n.id,rawId:pe(n.rawId),type:n.type,response:{clientDataJSON:pe(n.response.clientDataJSON),attestationObject:pe(n.response.attestationObject)}},a=await Se(`${G}/api/auth/register-verify`,{method:"POST",body:JSON.stringify(r)});if(a.verified)it("Security Key registered successfully!");else throw new Error(a.error||"Registration failed.")}catch(t){J(`Registration Failed: ${t.message}`),console.error(t)}finally{Ee()}}function sn(){var e;(e=m.loginModal)==null||e.classList.remove("hidden")}function Tr(){var e;(e=m.loginModal)==null||e.classList.add("hidden")}function Ue(){var e;(e=m.loadingIndicator)==null||e.classList.remove("hidden")}function Ee(){var e;(e=m.loadingIndicator)==null||e.classList.add("hidden")}function J(e){m.errorMessage.textContent=e,m.errorToast.classList.remove("hidden"),setTimeout(Rr,5e3)}function Rr(){var e;(e=m.errorToast)==null||e.classList.add("hidden")}function it(e){m.successMessage.textContent=e,m.successToast.classList.remove("hidden"),setTimeout(_r,3e3)}function _r(){var e;(e=m.successToast)==null||e.classList.add("hidden")}async function At(e=""){if(!Ae){m.noOrdersMessage.textContent="Please log in to view orders.",ye("idle");return}Ue(),ye("connecting"),m.noOrdersMessage.textContent="Loading orders...",m.noOrdersMessage.style.display="block",m.ordersList.innerHTML="";try{const t=e?`${G}/api/orders/search?q=${encodeURIComponent(e)}`:`${G}/api/orders`,n=await Se(t);n.length===0?m.noOrdersMessage.textContent="No orders found.":(m.noOrdersMessage.style.display="none",n.forEach(is)),ye("connected")}catch(t){console.error("[SHOP] Error fetching orders:",t),ye("error"),t.message!=="Authentication failed"&&J(`Could not fetch orders: ${t.message}`)}finally{Ee()}}function is(e){var a,i,o,c;const t=document.createElement("div");t.className="order-card",t.id=`order-card-${e.orderId}`;const n=e.amount?`$${(e.amount/100).toFixed(2)}`:"N/A",r=new Date(e.receivedAt).toLocaleString();t.innerHTML=da.sanitize(`
        <div class="flex justify-between items-start">
            <div>
                <h3 class="text-xl text-splotch-red">Order ID: <span class="font-mono text-sm">${e.orderId.substring(0,8)}...</span></h3>
                <p class="text-sm text-gray-600">Received: ${r}</p>
            </div>
            <div id="status-badge-${e.orderId}" class="status-${e.status.toLowerCase()} font-bold py-1 px-3 rounded-full text-sm">${e.status}</div>
        </div>
        <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4 order-details">
            <div>
                <dt>Name:</dt> <dd>${((a=e.billingContact)==null?void 0:a.givenName)||""} ${((i=e.billingContact)==null?void 0:i.familyName)||""}</dd>
                <dt>Email:</dt> <dd>${((o=e.billingContact)==null?void 0:o.email)||"N/A"}</dd>
            </div>
            <div>
                <dt>Quantity:</dt> <dd>${((c=e.orderDetails)==null?void 0:c.quantity)||"N/A"}</dd>
                <dt>Amount:</dt> <dd>${n}</dd>
            </div>
        </div>
        <div class="mt-4">
            <dt>Sticker Design:</dt>
            <a href="${G}${e.designImagePath}" target="_blank"><img src="${G}${e.designImagePath}" alt="Sticker Design" class="sticker-design"></a>
        </div>
        <div class="mt-4 flex flex-wrap gap-2">
            <button class="action-btn" data-order-id="${e.orderId}" data-status="ACCEPTED">Accept</button>
            <button class="action-btn" data-order-id="${e.orderId}" data-status="PRINTING">Print</button>
            <button class="action-btn" data-order-id="${e.orderId}" data-status="SHIPPED">Ship</button>
            <button class="action-btn" data-order-id="${e.orderId}" data-status="CANCELED">Cancel</button>
        </div>`),m.ordersList.prepend(t),t.querySelectorAll(".action-btn").forEach(l=>{l.addEventListener("click",u=>{const d=u.target.dataset.orderId,p=u.target.dataset.status;os(d,p)})})}async function os(e,t){Ue();try{await Se(`${G}/api/orders/${e}/status`,{method:"POST",body:JSON.stringify({status:t})}),it(`Order status updated to ${t}.`);const n=document.getElementById(`status-badge-${e}`);n&&(n.className=`status-${t.toLowerCase()} font-bold py-1 px-3 rounded-full text-sm`,n.textContent=t)}catch(n){J(`Update Failed: ${n.message}`),console.error(n)}finally{Ee()}}async function Zn(){const e=m.searchInput.value.trim();if(!e){At();return}At(e)}async function cs(){Ue(),m.nestedSvgContainer.innerHTML="<p>Nesting in progress...</p>";const e=Array.from(m.ordersList.querySelectorAll(".sticker-design")).map(t=>t.src);if(e.length===0){m.nestedSvgContainer.innerHTML="<p>No designs to nest.</p>",Ee();return}try{const t=await Promise.all(e.map(async(S,g)=>{try{const w=await(await fetch(S,{credentials:"include"})).text();return console.log(`SVG ${g} content:`,w),w}catch(E){throw console.error(`Failed to fetch SVG ${g} from ${S}:`,E),new Error(`Could not fetch SVG from ${S}`)}})),n=12*96,r=12*96,a=`<svg width="${n}" height="${r}"><rect x="0" y="0" width="${n}" height="${r}" fill="none" stroke="blue" stroke-width="2"/></svg>`,i=new pa,o=t.map(S=>i.load(S)),c=i.load(a),u={spacing:parseInt(m.spacingInput.value,10)||0,rotations:4},p=new SVGNest(c,o,u).start();m.nestedSvgContainer.innerHTML=p,window.nestedSvg=p,it("Nesting complete.")}catch(t){J(`Nesting failed: ${t.message}`)}finally{Ee()}}function ls(){if(!window.nestedSvg){J("No nested SVG to generate a cut file from.");return}const n=new DOMParser().parseFromString(window.nestedSvg,"image/svg+xml").documentElement,r=document.createElementNS("http://www.w3.org/2000/svg","svg");r.setAttribute("width",n.getAttribute("width")),r.setAttribute("height",n.getAttribute("height")),r.setAttribute("viewBox",n.getAttribute("viewBox")),n.querySelectorAll("path").forEach(l=>{const u=l.cloneNode();u.setAttribute("stroke","red"),u.setAttribute("fill","none"),r.appendChild(u)});const a=new XMLSerializer().serializeToString(r),i=new Blob([a],{type:"image/svg+xml"}),o=URL.createObjectURL(i),c=document.createElement("a");c.href=o,c.download="cut-file.svg",document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(o)}async function us(){try{const e=await fetch(`${G}/api/server-info`,{credentials:"include"}),{serverSessionToken:t}=await e.json();localStorage.setItem("serverSessionToken",t),console.log("[CLIENT] Initial server session token acquired.")}catch(e){console.error("Could not acquire server session token.",e)}}async function Qn(){if(!Ae)return ye("idle"),!1;ye("connecting");try{const e=await Se(`${G}/api/auth/verify-token`);return e.username?(an(Ae,e.username),!0):(ye("error"),!1)}catch(e){return ye("error"),console.error("Token verification failed:",e),st(),!1}}async function fs(){try{Ar=(await(await fetch(`${G}/api/csrf-token`,{credentials:"include"})).json()).csrfToken}catch(e){console.error("Fatal: Could not fetch CSRF token. App may not function correctly.",e),J("Could not establish a secure session with the server.")}}async function ds(){var r,a,i,o,c,l,u,d,p,S,g,E,w;Zt=rs(new URL(`${G}/.well-known/jwks.json`)),console.log("[CLIENT] Remote JWKS verifier created."),await us(),["orders-list","no-orders-message","refreshOrdersBtn","nestStickersBtn","nested-svg-container","spacingInput","registerBtn","loginBtn","auth-status","loading-indicator","error-toast","error-message","close-error-toast","success-toast","success-message","close-success-toast","searchInput","searchBtn","downloadCutFileBtn","login-modal","close-modal-btn","username-input","password-input","password-login-btn","webauthn-login-btn","webauthn-register-btn","connection-status-dot","connection-status-text"].forEach($=>{const he=$.replace(/-(\w)/g,(Te,z)=>z.toUpperCase());m[he]=document.getElementById($)}),await fs(),(r=m.refreshOrdersBtn)==null||r.addEventListener("click",()=>At()),(a=m.registerBtn)==null||a.addEventListener("click",Xn),(i=m.closeErrorToast)==null||i.addEventListener("click",Rr),(o=m.closeSuccessToast)==null||o.addEventListener("click",_r),(c=m.nestStickersBtn)==null||c.addEventListener("click",cs),(l=m.downloadCutFileBtn)==null||l.addEventListener("click",ls),(u=m.searchBtn)==null||u.addEventListener("click",Zn),(d=m.searchInput)==null||d.addEventListener("keyup",$=>{$.key==="Enter"&&Zn()}),(p=m.closeModalBtn)==null||p.addEventListener("click",Tr),(S=m.passwordLoginBtn)==null||S.addEventListener("click",ss),(g=m.webauthnLoginBtn)==null||g.addEventListener("click",as),(E=m.webauthnRegisterBtn)==null||E.addEventListener("click",Xn),(w=m.loginBtn)==null||w.addEventListener("click",sn);const n=new URLSearchParams(window.location.search).get("token");n?(localStorage.setItem("authToken",n),await Qn(),window.history.replaceState({},document.title,"/printshop.html")):await Qn()||st()}document.addEventListener("DOMContentLoaded",ds);
