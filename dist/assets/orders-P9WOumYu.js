import"./modulepreload-polyfill-B5Qt9EMX.js";/* empty css               *//* empty css                      */const i="http://localhost:3000";let m;async function w(){try{const r=await fetch(`${i}/api/csrf-token`,{credentials:"include"});if(!r.ok)throw new Error(`Server responded with ${r.status}`);const n=await r.json();if(!n.csrfToken)throw new Error("CSRF token not found in server response");m=n.csrfToken}catch(r){console.error("Error fetching CSRF token:",r);const n=document.getElementById("login-status");n&&(n.textContent="A security token could not be loaded. Please refresh the page.",n.style.color="red")}}document.addEventListener("DOMContentLoaded",async()=>{await w();const r=document.getElementById("login-section"),n=document.getElementById("order-history-section"),u=document.getElementById("loginBtn"),h=document.getElementById("emailInput"),a=document.getElementById("login-status"),c=document.getElementById("orders-list"),d=document.getElementById("no-orders-message"),g=new URLSearchParams(window.location.search).get("token");g&&f(g),u.addEventListener("click",async()=>{const o=h.value;if(!o){a.textContent="Please enter a valid email address.",a.style.color="red";return}try{if(!m)throw new Error("CSRF token is not available. Please refresh the page.");const t=await fetch(`${i}/api/auth/magic-login`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json","X-CSRF-Token":m},body:JSON.stringify({email:o,redirectPath:"/orders.html"})}),e=await t.json();if(t.ok)a.textContent="Magic link sent! Please check your email.",a.style.color="green";else throw new Error(e.error||"Failed to send magic link.")}catch(t){a.textContent=`Error: ${t.message}`,a.style.color="red"}});async function f(o){r.classList.add("hidden"),n.classList.remove("hidden");try{const t=await fetch(`${i}/api/orders/my-orders`,{credentials:"include",headers:{Authorization:`Bearer ${o}`}});if(!t.ok){const s=await t.json();throw new Error(s.error||"Could not fetch your orders.")}const e=await t.json();p(e,o)}catch(t){d.textContent=`Error loading orders: ${t.message}`,d.style.color="red"}}function p(o,t){if(c.innerHTML="",o.length===0){c.appendChild(d);return}o.forEach(e=>{const s=document.createElement("div");s.className="p-4 border rounded-lg shadow-sm bg-gray-50";const l=new Date(e.receivedAt).toLocaleDateString(),y=e.amount?`$${(e.amount/100).toFixed(2)}`:"N/A";s.innerHTML=`
                <div class="flex flex-col sm:flex-row justify-between items-start">
                    <div>
                        <h3 class="text-lg font-semibold text-splotch-red">Order ID: <span class="font-mono text-sm">${e.orderId.substring(0,8)}...</span></h3>
                        <p class="text-sm text-gray-600">Ordered on: ${l}</p>
                        <p class="text-sm text-gray-600">Amount: ${y}</p>
                        <p class="text-sm text-gray-600">Status: <span class="font-semibold">${e.status}</span></p>
                    </div>
                    <div class="mt-4 sm:mt-0 sm:ml-4 flex-shrink-0">
                        <img src="${i}${e.designImagePath}" alt="Sticker Design" class="w-24 h-24 object-cover border rounded-md">
                    </div>
                </div>
                <div class="mt-4">
                    <button class="reorder-btn button is-primary text-sm" data-design-image="${e.designImagePath}">Reorder This Sticker</button>
                </div>
            `,c.appendChild(s)}),document.querySelectorAll(".reorder-btn").forEach(e=>{e.addEventListener("click",s=>{const l=s.target.dataset.designImage;window.location.href=`/?design=${encodeURIComponent(l)}`})})}});
